[
  {
    "sql_id": "sql_1",
    "sql": "SELECT \n    a.suserid,\n    a.sgamecode,\n    SUM(a.ionlinetime) AS ionlinetime\nFROM dws_mgamejp_login_user_activity_di a\nINNER JOIN dim_vplayerid_vies_df b\n    ON a.suserid = b.suserid\nWHERE a.dtstatdate BETWEEN 20250530 AND 20250724\n    AND b.dtstatdate = '20250724'\n    AND b.itag = '其他'\n    AND a.sgamecode IN ('initiatived', 'jordass', 'esports', 'allianceforce', 'strategy', 'playzone', 'su')\n    AND a.saccounttype = '-100'\n    AND a.suseridtype IN ('qq', 'wxid')\n    AND a.splattype = '-100'\n    AND a.splat = '-100'\nGROUP BY a.suserid, a.sgamecode",
    "is_valid": true
  },
  {
    "sql_id": "sql_2",
    "sql": "SELECT DISTINCT\n    vplayerid AS gplayerid\nFROM dws_argothek_ce1_cbt2_vplayerid_suserid_di\nWHERE dtstatdate BETWEEN '20250717' AND '20250723'\n  AND vplayerid NOT IN (\n      SELECT vplayerid \n      FROM dim_extract_311381_conf\n  )",
    "is_valid": true
  },
  {
    "sql_id": "sql_3",
    "sql": "SELECT DISTINCT \n    dim.iuserid AS gplayerid\nFROM dws_argothek_oss_login_di AS oss\nINNER JOIN dim_argothek_gplayerid2qqwxid_df AS dim\n    ON oss.iuserid = dim.iuserid\n    AND dim.dtstatdate = '20250131'\n    AND dim.vGameAppid = 'initiatived'\nINNER JOIN dws_mgamejp_login_user_activity_di AS mgame\n    ON dim.suserid = mgame.suserid\n    AND mgame.dtstatdate BETWEEN '20250101' AND '20250131'\n    AND mgame.sgamecode = 'esports'\n    AND mgame.saccounttype = '-100'\n    AND mgame.suseridtype IN ('qq', 'wxid')\n    AND mgame.splattype IN ('-100', 'PC')\n    AND mgame.splat = '-100'\nWHERE oss.statis_date BETWEEN '20250101' AND '20250131'",
    "is_valid": true
  },
  {
    "sql_id": "sql_4",
    "sql": "SELECT \n    CASE \n        WHEN INSTR(vrolename, '#') > 0 \n        THEN SUBSTR(vrolename, 1, INSTR(vrolename, '#') - 1) \n        ELSE vrolename \n    END AS nickname,\n    COUNT(DISTINCT iuserid) AS user_count\nFROM dwd_argothek_playerlogin_hi\nWHERE tdbank_imp_date BETWEEN '20230712' AND '20250715'\n    AND vrolename IS NOT NULL\nGROUP BY \n    CASE \n        WHEN INSTR(vrolename, '#') > 0 \n        THEN SUBSTR(vrolename, 1, INSTR(vrolename, '#') - 1) \n        ELSE vrolename \n    END\nORDER BY user_count DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_6",
    "sql": "SELECT DISTINCT \n    a.vplayerid\nFROM \n    dws_argothek_ce1_cbt2_vplayerid_suserid_di AS a\nINNER JOIN \n    dim_argothek_gplayerid2qqwxid_df AS b\n    ON a.suserid = b.suserid\nWHERE \n    a.dtstatdate BETWEEN '20250612' AND '20250714'\n    AND a.itag = 'T2'\n    AND b.iregdate < '20250529'",
    "is_valid": true
  },
  {
    "sql_id": "sql_7",
    "sql": "SELECT \n    dtstatdate,\n    iregway AS reg_channel,\n    COUNT(DISTINCT vplayerid) AS new_user_cnt\nFROM \n    dws_argothek_ce1_cbt2_vplayerid_suserid_di\nWHERE \n    dtstatdate BETWEEN '20250703' AND '20250706'\n    AND is_reg = '1'\n    AND iregway IN (\n        '89903934', '89903933', '89903932', \n        '89902725', '89902724', '89902723', \n        '89900960', '89900961', '89900962'\n    )\n    AND sourcename NOT IN ('内部体验', '买量测试')\nGROUP BY \n    dtstatdate,\n    iregway\nORDER BY \n    dtstatdate,\n    iregway;",
    "is_valid": true
  },
  {
    "sql_id": "sql_8",
    "sql": "SELECT \n    DATE_FORMAT(`dteventtime`, '%Y-%m') AS `month`,\n    `gamepodid` AS `server_node`,\n    MAX(`dteventtime`) AS `peak_time`,\n    COUNT(DISTINCT `matchid`) AS `total_completed_matches`,\n    COUNT(DISTINCT CASE WHEN `queueid` = 'competitive' THEN `matchid` END) AS `competitive_matches`,\n    COUNT(DISTINCT CASE WHEN `queueid` = 'unrated' THEN `matchid` END) AS `unrated_matches`,\n    COUNT(DISTINCT CASE WHEN `queueid` = 'swiftplay' THEN `matchid` END) AS `swiftplay_matches`\nFROM \n    `dwd_argothek_matchdetails_hi`\nWHERE \n    `tdbank_imp_date` BETWEEN '20250401' AND '20250630'\n    AND LOWER(`completionstate`) IN ('completed', 'surrendered')\nGROUP BY \n    DATE_FORMAT(`dteventtime`, '%Y-%m'),\n    `gamepodid`\nORDER BY \n    `month`,\n    `gamepodid`;",
    "is_valid": true
  },
  {
    "sql_id": "sql_9",
    "sql": "SELECT \n    u.city_level AS 城市等级,\n    COUNT(DISTINCT a.suserid) AS 用户人数\nFROM \n    dim_mgamejp_account_allinfo_nf AS a\nINNER JOIN \n    dim_uf_player_gameinfo_mf AS u\n    ON a.suserid = u.userid \n    AND a.suseridtype = u.id_type\nWHERE \n    a.dtstatdate = '20250702'\n    AND a.saccounttype = '-100'\n    AND a.suseridtype IN ('qq', 'wxid')\n    AND a.sgamecode IN ('esports', 'mobile_live', 'initiatived', 'allianceforce', 'strategy', 'jordass', 'su', 'playzone', 'battlezone', 'battlearena', 'weapon', 'playhub', 'manager', 'apgame')\n    AND a.splattype = '-100'\n    AND a.ilastactdate >= '20250104'\n    AND u.kp_imp_date = '202506'\nGROUP BY \n    u.city_level\nORDER BY \n    用户人数 DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_10",
    "sql": "SELECT \n    a.expressionassetid AS item_id,\n    c.seasonidname AS season_name,\n    COUNT(DISTINCT CASE \n        WHEN a.expressionassetid IS NOT NULL \n        THEN CONCAT(a.tdbank_imp_date, '_', a.expressionassetid) \n    END) AS current_season_users,\n    COUNT(DISTINCT b.purchasedItemId) AS current_season_buyers\nFROM \n    dwd_argothek_playerloadout_expressions_hi a\nINNER JOIN \n    dim_argothek_seasondate_df c\n    ON a.tdbank_imp_date = c.idate\nLEFT JOIN \n    dwd_argothek_commercialization_gearid_df b\n    ON a.expressionassetid = b.purchasedItemId\n    AND b.idate = c.idate\n    AND b.purchaseSource = 'BATTLEPASS_PROGRESS'\n    AND b.itemtype = 'd5f120f8-ff8c-4aac-92ea-f2b5acbe9475'\n    AND b.dtstatdate = '20250615'\nWHERE \n    a.tdbank_imp_date BETWEEN '20230712' AND '20250615'\n    AND c.idate BETWEEN '20230712' AND '20250615'\n    AND a.expressionassetid IS NOT NULL\n    AND a.expressiontypeid = 'd5f120f8-ff8c-4aac-92ea-f2b5acbe9475'\nGROUP BY \n    a.expressionassetid,\n    c.seasonidname\nORDER BY \n    c.seasonidname, \n    a.expressionassetid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_11",
    "sql": "SELECT \n    COUNT(DISTINCT a.iuserid) AS active_users_30d,\n    COUNT(DISTINCT CASE WHEN b.gear_count = 11 THEN a.iuserid END) AS active_users_with_all_goods_30d\nFROM (\n    SELECT \n        iuserid\n    FROM dws_argothek_oss_useractivity_df\n    WHERE statis_date = 20250617\n      AND iworldid = 255\n      AND instr(substr(iactivity, 1, 30), '1') > 0\n) a\nLEFT JOIN (\n    SELECT \n        iuserid,\n        COUNT(DISTINCT iGoodsId) AS gear_count\n    FROM dwd_argothek_gearrecord_df\n    WHERE dtstatdate = '20250617'\n      AND iGoodsId IN (\n          '71d260ca-4bad-81f2-0298-44860341a7a6',\n          '48601754-442d-98cb-2109-3fb2075500ec',\n          'a9126263-439c-7be6-d668-52a6c0c0a36f',\n          '34ecc788-4034-71d2-a0ac-c398b8ecb2ae',\n          '56f98991-43f8-dcc8-189e-08b7ae6c42ad',\n          '8453f8ef-4c0b-46e2-8768-3e9e45c67a2c',\n          '06d90274-435f-3e32-9d57-26bc228ae2e5',\n          '8196dea4-4229-c951-13a9-088fb13b3512',\n          '3abc330f-444a-6dfd-5863-81856ba62624',\n          '041a43a4-46fe-dab7-c974-36bf91eab33d',\n          '5b863cb9-4e41-ec89-69ee-49a223d05ff1'\n      )\n      AND iCount > 0\n    GROUP BY iuserid\n    HAVING COUNT(DISTINCT iGoodsId) = 11\n) b ON a.iuserid = b.iuserid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_13",
    "sql": "SELECT DISTINCT\n    w.swxid\nFROM (\n    SELECT \n        l.iuserid,\n        COUNT(DISTINCT l.statis_date) AS active_days,\n        MAX(l.statis_date) AS last_active_date\n    FROM dws_argothek_oss_login_di l\n    WHERE l.statis_date BETWEEN '20230712' AND '20250612'\n    GROUP BY l.iuserid\n    HAVING COUNT(DISTINCT l.statis_date) >= 30\n        AND MAX(l.statis_date) < '20250312'\n) a\nLEFT JOIN (\n    SELECT \n        iuserid,\n        SUM(ftranamt) AS total_pay\n    FROM dws_argothek_oss_portaltransaction_di\n    WHERE statis_date BETWEEN '20230712' AND '20250612'\n        AND vusertype IN ('qq', 'wx')\n    GROUP BY iuserid\n) p ON a.iuserid = p.iuserid\nINNER JOIN dim_mgamejp_tbplayerid2qq_nf q ON a.iuserid = q.iqq\nINNER JOIN dim_mgamejp_idconversion_wxid_qq_nf w ON q.iqq = w.iqq\nWHERE p.total_pay IS NULL OR p.total_pay / 100 <= 1500;",
    "is_valid": true
  },
  {
    "sql_id": "sql_14",
    "sql": "SELECT DISTINCT\n    d.suserid\nFROM (\n    -- 5月活跃用户集合\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date BETWEEN '20250501' AND '20250531'\n) AS may_active\nLEFT ANTI JOIN (\n    -- 6月活跃用户集合\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date BETWEEN '20250601' AND '20250630'\n) AS june_active\nON may_active.iuserid = june_active.iuserid\nINNER JOIN dim_argothek_gplayerid2qqwxid_df AS d\nON may_active.iuserid = d.iuserid\nWHERE d.dtstatdate = '20250610'",
    "is_valid": true
  },
  {
    "sql_id": "sql_15",
    "sql": "SELECT DISTINCT \n    a.iuserid AS gplayerid\nFROM dws_argothek_oss_useractivity_df a\nINNER JOIN dim_argothek_gplayerid2qqwxid_df b\n    ON a.iuserid = b.iuserid\n    AND b.dtstatdate = '20250608'\nINNER JOIN dws_mgamejp_login_user_activity_di c\n    ON b.suserid = c.suserid\n    AND c.dtstatdate = '20250608'\n    AND c.sgamecode = 'esports'\n    AND c.itimes >= 1\n    AND c.saccounttype = '-100'\n    AND c.suseridtype IN ('qq', 'wxid')\n    AND c.splattype = 'PC'\n    AND c.splat = '-100'\nWHERE a.statis_date = '20250531'\n    AND a.iworldid = 'initiatived'\n    AND INSTR(SUBSTR(REVERSE(RPAD(a.iactivity, 128, '0')), 1, 31), '1') = 0\n    AND INSTR(SUBSTR(REVERSE(RPAD(a.iactivity, 128, '0')), 32, 31), '1') > 0",
    "is_valid": true
  },
  {
    "sql_id": "sql_16",
    "sql": "SELECT \n    tdbank_imp_date AS date,\n    tier_name,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') THEN matchid END) AS non_surrender_matches,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) IN ('surrendered') THEN matchid END) AS surrender_matches,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') AND ABS(roundswon - (roundsplayed - roundswon)) >= 6 THEN matchid END) AS roundsdiff_gte6,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') AND ABS(roundswon - (roundsplayed - roundswon)) >= 8 THEN matchid END) AS roundsdiff_gte8\nFROM (\n    SELECT \n        tdbank_imp_date,\n        matchid,\n        completionstate,\n        roundswon,\n        roundsplayed,\n        CASE \n            WHEN competitivetier IN (3, 4, 5) THEN '黑铁'\n            WHEN competitivetier IN (6, 7, 8) THEN '黄铜'\n            WHEN competitivetier IN (9, 10, 11) THEN '白银'\n            WHEN competitivetier IN (12, 13, 14) THEN '黄金'\n            WHEN competitivetier IN (15, 16, 17) THEN '白金'\n            WHEN competitivetier IN (18, 19, 20) THEN '钻石'\n            WHEN competitivetier IN (21, 22, 23) THEN '超凡'\n            WHEN competitivetier >= 24 THEN '神话及以上'\n            ELSE '无段位'\n        END AS tier_name\n    FROM dwd_argothek_playermatchstats_hi\n    WHERE tdbank_imp_date BETWEEN '20230712' AND '20250531'\n        AND queueid = 'competitive'\n) t1\nGROUP BY tdbank_imp_date, tier_name\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS date,\n    '全量段位' AS tier_name,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') THEN matchid END) AS non_surrender_matches,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) IN ('surrendered') THEN matchid END) AS surrender_matches,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') AND ABS(roundswon - (roundsplayed - roundswon)) >= 6 THEN matchid END) AS roundsdiff_gte6,\n    COUNT(DISTINCT CASE WHEN LOWER(completionstate) NOT IN ('surrendered') AND ABS(roundswon - (roundsplayed - roundswon)) >= 8 THEN matchid END) AS roundsdiff_gte8\nFROM dwd_argothek_playermatchstats_hi\nWHERE tdbank_imp_date BETWEEN '20230712' AND '20250531'\n    AND queueid = 'competitive'\nGROUP BY tdbank_imp_date\n\nORDER BY date, tier_name;",
    "is_valid": true
  },
  {
    "sql_id": "sql_18",
    "sql": "SELECT \n    `statis_date` AS `date`,\n    `iloginway` AS `channel`,\n    COUNT(DISTINCT `iuserid`) AS `active_users`\nFROM \n    `dws_argothek_oss_login_di`\nWHERE \n    `statis_date` BETWEEN '20250506' AND '20250512'\n    AND `iloginway` IN (1, 10, 11, 12, 35, 20, 28, 29, 30, 31, 32, 33, 34, 36)\nGROUP BY \n    `statis_date`,\n    `iloginway`\nORDER BY \n    `statis_date`,\n    `iloginway`;",
    "is_valid": true
  },
  {
    "sql_id": "sql_19",
    "sql": "WITH active_users AS (\n    -- 获取2024年5月2日的日活跃用户\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date = '20240502'\n),\nuser_gameplay AS (\n    -- 获取活跃用户在7天内的玩法行为\n    SELECT \n        a.iuserid,\n        m.queueid\n    FROM active_users a\n    INNER JOIN dim_argothek_gplayerid_vroleid_df d\n        ON a.iuserid = d.iuserid\n        AND d.dtstatdate = '20240502'\n        AND d.iareaid = '101'\n    INNER JOIN dwd_argothek_playermatchstats_hi m\n        ON d.vroleid = m.vroleid\n        AND m.tdbank_imp_date BETWEEN '20240426' AND '20240502'\n        AND m.ismatchcompleted = 1\n    GROUP BY a.iuserid, m.queueid\n),\nuser_mode_summary AS (\n    -- 统计每个用户玩的模式类型\n    SELECT \n        iuserid,\n        COUNT(DISTINCT queueid) AS mode_count,\n        SUM(CASE WHEN queueid IN ('QuickMatch', 'RushMode', 'CombatArena') THEN 1 ELSE 0 END) AS leisure_mode_count,\n        SUM(CASE WHEN queueid NOT IN ('QuickMatch', 'RushMode', 'CombatArena') THEN 1 ELSE 0 END) AS other_mode_count,\n        MAX(CASE WHEN queueid = 'QuickMatch' THEN 1 ELSE 0 END) AS has_quickmatch,\n        MAX(CASE WHEN queueid = 'RushMode' THEN 1 ELSE 0 END) AS has_rushmode,\n        MAX(CASE WHEN queueid = 'CombatArena' THEN 1 ELSE 0 END) AS has_combatarena\n    FROM user_gameplay\n    GROUP BY iuserid\n),\nweekly_activity AS (\n    -- 计算周活跃频次\n    SELECT \n        a.iuserid,\n        LENGTH(REPLACE(SUBSTR(d.cbitmap, 1, 7), '0', '')) AS weekly_active_days\n    FROM active_users a\n    INNER JOIN dim_argothek_gplayerid_vroleid_df d\n        ON a.iuserid = d.iuserid\n        AND d.dtstatdate = '20240502'\n        AND d.iareaid = '101'\n)\nSELECT \n    COUNT(DISTINCT CASE WHEN u.mode_count = 1 AND u.has_quickmatch = 1 THEN u.iuserid END) AS only_quickmatch_users,\n    COUNT(DISTINCT CASE WHEN u.mode_count = 1 AND u.has_rushmode = 1 THEN u.iuserid END) AS only_rushmode_users,\n    COUNT(DISTINCT CASE WHEN u.mode_count = 1 AND u.has_combatarena = 1 THEN u.iuserid END) AS only_combatarena_users,\n    COUNT(DISTINCT CASE WHEN u.leisure_mode_count > 0 AND u.other_mode_count = 0 THEN u.iuserid END) AS only_three_modes_users,\n    AVG(CASE WHEN u.leisure_mode_count > 0 AND u.other_mode_count = 0 THEN w.weekly_active_days END) AS avg_weekly_active_frequency\nFROM user_mode_summary u\nLEFT JOIN weekly_activity w\n    ON u.iuserid = w.iuserid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_20",
    "sql": "SELECT \n    SUBSTR(logout.tdbank_imp_date, 1, 6) AS month,\n    -- 人均对局时长（小时）\n    ROUND(SUM(match.gamelengthmillis) / COUNT(DISTINCT logout.iuserid) / 3600000, 2) AS avg_match_duration_hours,\n    -- 网吧时间占当月游戏时间比例\n    ROUND(SUM(CASE WHEN logout.inetbarlevel = '2' THEN logout.ionlinetime ELSE 0 END) * 1.0 / \n          NULLIF(SUM(logout.ionlinetime), 0), 4) AS netbar_time_ratio,\n    -- 有对局的天数（按用户统计平均值）\n    ROUND(COUNT(DISTINCT CONCAT(logout.iuserid, '_', logout.tdbank_imp_date)) * 1.0 / \n          COUNT(DISTINCT logout.iuserid), 1) AS avg_match_days,\n    -- 排位模式时长（小时）\n    ROUND(SUM(CASE WHEN match.queueid = 'competitive' THEN match.gamelengthmillis ELSE 0 END) / 3600000, 2) AS competitive_duration_hours,\n    -- 排位模式组队率\n    ROUND(COUNT(DISTINCT CASE WHEN match.queueid = 'competitive' AND match.partyid IS NOT NULL THEN match.matchid END) * 1.0 / \n          NULLIF(COUNT(DISTINCT CASE WHEN match.queueid = 'competitive' THEN match.matchid END), 0), 4) AS competitive_party_rate,\n    -- 月付费率\n    ROUND(COUNT(DISTINCT pay.iuserid) * 1.0 / COUNT(DISTINCT logout.iuserid), 4) AS monthly_payment_rate,\n    -- 月ARPA\n    ROUND(SUM(pay.ftranamt) / 100.0 / COUNT(DISTINCT logout.iuserid), 2) AS monthly_arpa,\n    -- 月ARPPU\n    ROUND(SUM(pay.ftranamt) / 100.0 / NULLIF(COUNT(DISTINCT pay.iuserid), 0), 2) AS monthly_arppu,\n    -- 高校特权激活率\n    ROUND(COUNT(DISTINCT CASE WHEN logout.icampuslevel > '0' THEN logout.iuserid END) * 1.0 / \n          COUNT(DISTINCT logout.iuserid), 4) AS campus_activation_rate\nFROM \n    dwd_argothek_playerlogout_hi AS logout\nLEFT JOIN \n    dwd_argothek_playermatchstats_hi AS match\n    ON logout.vroleid = match.vroleid\n    AND match.tdbank_imp_date BETWEEN '20240101' AND '20240430'\nLEFT JOIN \n    dws_argothek_oss_portaltransaction_di AS pay\n    ON logout.iuserid = pay.iuserid\n    AND pay.statis_date BETWEEN '20240101' AND '20240430'\nWHERE \n    logout.tdbank_imp_date BETWEEN '20240101' AND '20240430'\n    AND logout.inetbarlevel = '2'\nGROUP BY \n    SUBSTR(logout.tdbank_imp_date, 1, 6)\nORDER BY \n    month;",
    "is_valid": true
  },
  {
    "sql_id": "sql_22",
    "sql": "SELECT DISTINCT\n    b.suserid AS QQ\nFROM (\n    SELECT \n        iuserid,\n        COUNT(DISTINCT statis_date) AS login_days\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date BETWEEN '20250330' AND '20250428'\n        AND iloginway = 3\n    GROUP BY iuserid\n    HAVING COUNT(DISTINCT statis_date) BETWEEN 5 AND 8\n) a\nINNER JOIN dim_argothek_gplayerid2qqwxid_df b\n    ON a.iuserid = b.iuserid\nWHERE b.dtstatdate = '20250428'\n    AND b.swxid_type = 'qq'\n    AND a.login_days = 8",
    "is_valid": true
  },
  {
    "sql_id": "sql_23",
    "sql": "SELECT DISTINCT\n    d.suserid AS qq\nFROM dwd_argothek_playermatchstats_hi a\nINNER JOIN dim_argothek_gplayerid_vroleid_df b\n    ON a.vroleid = b.vRoleID\n    AND b.dtstatdate = '20250330'\nINNER JOIN dws_argothek_oss_login_di c\n    ON b.iuserid = c.iuserid\n    AND c.statis_date BETWEEN '20250324' AND '20250330'\n    AND c.iloginway = 3\nINNER JOIN dim_argothek_gplayerid2qqwxid_df d\n    ON b.iuserid = d.iuserid\n    AND d.dtstatdate = '20250330'\n    AND d.swxid_type = 'qq'\nWHERE a.tdbank_imp_date BETWEEN '20250324' AND '20250330'",
    "is_valid": true
  },
  {
    "sql_id": "sql_24",
    "sql": "WITH hero_picks AS (\n    -- 英雄1（2个characterid）\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20230726' AND '20230801'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` IN ('e370fa57-4757-3604-3648-499e1f642d3f', 'cc8b64c8-4b25-4ff9-6e7f-37b4da43d235')\n    GROUP BY `characterid`, `subject`\n    \n    UNION ALL\n    \n    -- 英雄2\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20231101' AND '20231107'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` = '0e38b510-41a8-5780-5e8f-568b2a4f2d6c'\n    GROUP BY `characterid`, `subject`\n    \n    UNION ALL\n    \n    -- 英雄3\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20240327' AND '20240402'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` = '1dbf2edd-4729-0984-3115-daa5eed44993'\n    GROUP BY `characterid`, `subject`\n    \n    UNION ALL\n    \n    -- 英雄4\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20240829' AND '20240904'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` = 'efba5359-4016-a1e5-7626-b1ae76895940'\n    GROUP BY `characterid`, `subject`\n    \n    UNION ALL\n    \n    -- 英雄5\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20250109' AND '20250115'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` = 'b444168c-4e35-8076-db47-ef9bf368f384'\n    GROUP BY `characterid`, `subject`\n    \n    UNION ALL\n    \n    -- 英雄6\n    SELECT \n        `characterid`,\n        `subject`,\n        COUNT(*) AS pick_count\n    FROM `dwd_argothek_playermatchdetail_hi`\n    WHERE `tdbank_imp_date` BETWEEN '20250306' AND '20250312'\n        AND `provisioningflowid` = 'Matchmaking'\n        AND `characterid` = 'df1cb487-4902-002e-5c17-d28e83e78588'\n    GROUP BY `characterid`, `subject`\n)\n\nSELECT \n    `characterid` AS hero_id,\n    COUNT(DISTINCT CASE WHEN `pick_count` > 3 THEN `subject` END) AS players_over_3,\n    COUNT(DISTINCT CASE WHEN `pick_count` > 10 THEN `subject` END) AS players_over_10,\n    COUNT(DISTINCT `subject`) AS total_players,\n    ROUND(COUNT(DISTINCT CASE WHEN `pick_count` > 3 THEN `subject` END) * 1.0 / COUNT(DISTINCT `subject`), 4) AS ratio_over_3,\n    ROUND(COUNT(DISTINCT CASE WHEN `pick_count` > 10 THEN `subject` END) * 1.0 / COUNT(DISTINCT `subject`), 4) AS ratio_over_10\nFROM hero_picks\nGROUP BY `characterid`\nORDER BY `characterid`;",
    "is_valid": true
  },
  {
    "sql_id": "sql_26",
    "sql": "SELECT \n    SUM(CASE WHEN a.tag = 'EnemiesBlinded' THEN a.amount ELSE 0 END) AS enemies_blinded_count,\n    SUM(CASE WHEN a.tag = 'AlliesBlinded' THEN a.amount ELSE 0 END) AS allies_blinded_count\nFROM \n    dwd_argothek_abilityinfo_effects_hi a\nINNER JOIN \n    dwd_argothek_matchdetails_hi m\n    ON a.matchinfomatchid = m.matchid\nWHERE \n    a.tdbank_imp_date BETWEEN '20240101' AND '20241216'\n    AND m.provisioningflowid = 'Matchmaking'\n    AND a.tag IN ('EnemiesBlinded', 'AlliesBlinded');",
    "is_valid": true
  },
  {
    "sql_id": "sql_27",
    "sql": "SELECT \n    COUNT(1) AS weapon_代买次数\nFROM \n    dwd_argothek_apinventorymovementlog_hi AS t1\nINNER JOIN \n    dwd_argothek_matchdetails_hi AS t2\nON \n    t1.matchinfomatchid = t2.matchid\nWHERE \n    t1.tdbank_imp_date BETWEEN '20240101' AND '20241216'\n    AND t1.transactiontype = 'FulfillRequest'\n    AND t2.provisioningflowid = 'Matchmaking'",
    "is_valid": true
  },
  {
    "sql_id": "sql_29",
    "sql": "WITH daily_mode_stats AS (\n  -- 每日每个玩法的参与用户数和人均对局数\n  SELECT \n    dtstatdate,\n    CASE \n      WHEN modename = '传统模式' AND submodename LIKE 'CG%' AND mapname = '群屿' THEN '主题群屿'\n      WHEN modename = '传统模式' AND mapname = '群屿' THEN '传统群屿'\n      WHEN modename = '传统模式' AND mapname = '假日群岛' THEN '假日群岛'\n      WHEN modename = '传统模式' AND mapname = '荣耀之城' THEN '荣耀之城'\n      WHEN submodename = '广域战场模式' THEN '广域战场'\n      WHEN submodename = '极能形态模式' THEN '极能形态'\n      WHEN modename = '组队竞技' THEN '组竞'\n      WHEN modename = '休闲模式' THEN '休闲'\n      WHEN modename = '乐园' THEN '乐园'\n      WHEN modename = '领地' THEN '领地'\n      WHEN modename = '广阔天地' THEN '广阔天地'\n      WHEN modename = '生存模式' THEN '隧道'\n      ELSE '其他模式'\n    END AS gameplay_name,\n    COUNT(DISTINCT vplayerid) AS daily_participate_users,\n    COUNT(*) / COUNT(DISTINCT vplayerid) AS daily_avg_rounds\n  FROM dws_jordass_mode_roundrecord_di\n  WHERE dtstatdate BETWEEN '20240618' AND '20250330'\n  GROUP BY dtstatdate, gameplay_name\n),\ndaily_active_users AS (\n  -- 每日总活跃用户数（所有平台）\n  SELECT \n    dtstatdate,\n    COUNT(DISTINCT vplayerid) AS daily_active_users\n  FROM dws_jordass_login_di\n  WHERE dtstatdate BETWEEN '20240618' AND '20250330'\n    AND platid = 255\n  GROUP BY dtstatdate\n),\ndaily_stats AS (\n  -- 合并每日玩法数据和活跃用户数，计算自然周和参与率\n  SELECT \n    m.dtstatdate,\n    DATE_FORMAT(DATE_SUB(FROM_UNIXTIME(UNIX_TIMESTAMP(m.dtstatdate,'yyyyMMdd')), PMOD(DATEDIFF(FROM_UNIXTIME(UNIX_TIMESTAMP(m.dtstatdate,'yyyyMMdd')), '1900-01-03'), 7)), 'yyyyMMdd') AS natural_week,\n    m.gameplay_name,\n    m.daily_participate_users,\n    m.daily_avg_rounds,\n    a.daily_active_users,\n    m.daily_participate_users / a.daily_active_users AS daily_participate_rate\n  FROM daily_mode_stats m\n  JOIN daily_active_users a ON m.dtstatdate = a.dtstatdate\n)\nSELECT \n  natural_week,\n  gameplay_name,\n  AVG(daily_participate_users) AS week_avg_daily_participate_users,\n  AVG(daily_participate_rate) AS week_avg_daily_participate_rate,\n  AVG(daily_avg_rounds) AS week_avg_daily_rounds\nFROM daily_stats\nGROUP BY natural_week, gameplay_name\nORDER BY natural_week, gameplay_name;",
    "is_valid": true
  },
  {
    "sql_id": "sql_31",
    "sql": "WITH platform_active AS (\n    -- Step 1: 协作平台活跃用户\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_buttonpress_pre_di\n    WHERE dtstatdate BETWEEN '20250217' AND '20250318'\n),\nnon_coop_gameplay AS (\n    -- Step 2: 排除在协作玩法活跃的用户（取交集）\n    SELECT DISTINCT a.vplayerid\n    FROM platform_active a\n    WHERE NOT EXISTS (\n        SELECT 1\n        FROM dws_jordass_matchlog_stat_di b\n        WHERE b.vplayerid = a.vplayerid\n          AND b.dtstatdate BETWEEN '20250217' AND '20250318'\n          AND b.vtemp1 = '协作'\n    )\n),\nmode_stats AS (\n    -- Step 3: 计算目标用户在各玩法的对局次数\n    SELECT \n        c.vplayerid,\n        c.modename,\n        COUNT(*) AS play_count,\n        ROW_NUMBER() OVER (PARTITION BY c.vplayerid ORDER BY COUNT(*) DESC) AS rn\n    FROM dws_jordass_mode_roundrecord_di c\n    INNER JOIN non_coop_gameplay d ON c.vplayerid = d.vplayerid\n    WHERE c.dtstatdate BETWEEN '20250217' AND '20250318'\n      AND c.modename IN ('传统模式','休闲模式','组队竞技','领地','乐园','广阔天地','创意创作间','生存模式')\n    GROUP BY c.vplayerid, c.modename\n)\n-- Step 4: 统计主玩玩法分布\nSELECT \n    modename AS 主玩玩法,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM mode_stats\nWHERE rn = 1  -- 只保留每个用户对局次数最多的玩法（主玩）\nGROUP BY modename\nORDER BY 人数 DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_32",
    "sql": "SELECT \n    dtstatdate AS date,\n    COUNT(DISTINCT vplayerid) AS participate_users,\n    SUM(roundtime) / 60 AS duration_minutes\nFROM \n    dws_jordass_mode_roundrecord_di\nWHERE \n    (dtstatdate BETWEEN '20230114' AND '20230128')\n    OR (dtstatdate BETWEEN '20240202' AND '20240216')\n    OR (dtstatdate BETWEEN '20250121' AND '20250204')\nGROUP BY \n    dtstatdate\nORDER BY \n    dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_40",
    "sql": "SELECT \n    SUBSTR(dtstatdate, 1, 6) AS month,\n    -- 新进用户：当日活跃且注册日期在当月\n    COUNT(DISTINCT CASE \n        WHEN SUBSTR(cbitmap, 1, 1) = '1' \n        AND dregdate >= CONCAT(SUBSTR(dtstatdate, 1, 6), '01') \n        AND dregdate <= dtstatdate \n        THEN vplayerid \n    END) AS new_users,\n    -- 回流用户：当日活跃、前一日不活跃、注册日期早于当月、历史有活跃\n    COUNT(DISTINCT CASE \n        WHEN SUBSTR(cbitmap, 1, 1) = '1' \n        AND SUBSTR(cbitmap, 2, 1) = '0' \n        AND dregdate < CONCAT(SUBSTR(dtstatdate, 1, 6), '01') \n        AND INSTR(SUBSTR(cbitmap, 2, 99), '1') > 0\n        THEN vplayerid \n    END) AS return_users,\n    -- 轻度留存：当日活跃、前一日活跃、当月活跃1-4天\n    COUNT(DISTINCT CASE \n        WHEN SUBSTR(cbitmap, 1, 1) = '1' \n        AND SUBSTR(cbitmap, 2, 1) = '1' \n        AND LENGTH(REPLACE(\n            SUBSTR(cbitmap, 1, CAST(SUBSTR(dtstatdate, 7, 2) AS INT)), \n            '0', ''\n        )) BETWEEN 1 AND 4\n        THEN vplayerid \n    END) AS light_retention,\n    -- 中度留存：当日活跃、前一日活跃、当月活跃5-15天\n    COUNT(DISTINCT CASE \n        WHEN SUBSTR(cbitmap, 1, 1) = '1' \n        AND SUBSTR(cbitmap, 2, 1) = '1' \n        AND LENGTH(REPLACE(\n            SUBSTR(cbitmap, 1, CAST(SUBSTR(dtstatdate, 7, 2) AS INT)), \n            '0', ''\n        )) BETWEEN 5 AND 15\n        THEN vplayerid \n    END) AS medium_retention,\n    -- 重度留存：当日活跃、前一日活跃、当月活跃16天及以上\n    COUNT(DISTINCT CASE \n        WHEN SUBSTR(cbitmap, 1, 1) = '1' \n        AND SUBSTR(cbitmap, 2, 1) = '1' \n        AND LENGTH(REPLACE(\n            SUBSTR(cbitmap, 1, CAST(SUBSTR(dtstatdate, 7, 2) AS INT)), \n            '0', ''\n        )) >= 16\n        THEN vplayerid \n    END) AS heavy_retention\nFROM dws_jordass_login_df\nWHERE dtstatdate IN ('20240331', '20240430', '20240531', '20240630')\n  AND platid = 255\nGROUP BY SUBSTR(dtstatdate, 1, 6)\nORDER BY month;",
    "is_valid": true
  },
  {
    "sql_id": "sql_41",
    "sql": "SELECT \n    dtstatdate,\n    COUNT(DISTINCT vplayerid) AS player_count\nFROM \n    dws_jordass_login_di\nWHERE \n    dtstatdate BETWEEN '20240101' AND '20240103'\n    AND platid = 255\nGROUP BY \n    dtstatdate\nORDER BY \n    dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_42",
    "sql": "SELECT \n    dtstatdate AS 日期,\n    SPLIT(extarg2, '_')[1] AS extarg2_second_part,\n    COUNT(DISTINCT vplayerid) AS user_count,\n    COUNT(1) AS click_count\nFROM \n    dws_jordass_buttonpress_pre_di\nWHERE \n    dtstatdate BETWEEN '20211101' AND '20211130'\n    AND SPLIT(extarg2, '_')[1] IN ('8', '16', '17')\nGROUP BY \n    dtstatdate,\n    SPLIT(extarg2, '_')[1]\nORDER BY \n    dtstatdate,\n    extarg2_second_part;",
    "is_valid": true
  },
  {
    "sql_id": "sql_43",
    "sql": "SELECT \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END AS active_level,\n    COUNT(DISTINCT vplayerid) AS player_count\nFROM (\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS active_days\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20250101' AND '20250131'\n        AND platid = 255\n    GROUP BY vplayerid\n) t\nGROUP BY \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END\nORDER BY \n    CASE active_level\n        WHEN '轻度' THEN 1\n        WHEN '中度' THEN 2\n        WHEN '重度' THEN 3\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_44",
    "sql": "SELECT \n    CASE \n        WHEN total_amount <= 12 THEN '小R'\n        WHEN total_amount > 12 AND total_amount <= 60 THEN '中R'\n        WHEN total_amount > 60 AND total_amount <= 180 THEN '大R'\n        WHEN total_amount > 180 THEN '超R'\n        ELSE '未知'\n    END AS pay_level,\n    COUNT(DISTINCT vplayerid) AS pay_user_count,\n    SUM(total_amount) AS total_pay_amount\nFROM (\n    SELECT \n        vplayerid,\n        SUM(imoney) / 100 AS total_amount\n    FROM dws_jordass_water_di\n    WHERE dtstatdate BETWEEN '20240101' AND '20241231'\n    GROUP BY vplayerid\n) t\nGROUP BY \n    CASE \n        WHEN total_amount <= 12 THEN '小R'\n        WHEN total_amount > 12 AND total_amount <= 60 THEN '中R'\n        WHEN total_amount > 60 AND total_amount <= 180 THEN '大R'\n        WHEN total_amount > 180 THEN '超R'\n        ELSE '未知'\n    END\nORDER BY \n    CASE pay_level\n        WHEN '小R' THEN 1\n        WHEN '中R' THEN 2\n        WHEN '大R' THEN 3\n        WHEN '超R' THEN 4\n        ELSE 5\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_47",
    "sql": "SELECT COUNT(DISTINCT a.vplayerid) AS lost_paying_users\nFROM (\n    -- 7-8月活跃的微信用户\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20230701' AND '20230831'\n      AND vgameappid = 'wx'\n) a\nINNER JOIN (\n    -- 7-8月有付费的微信用户\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_water_di\n    WHERE dtstatdate BETWEEN '20230701' AND '20230831'\n      AND vgameappid = 'wx'\n) b ON a.vplayerid = b.vplayerid\nWHERE a.vplayerid NOT IN (\n    -- 9月1-21日活跃的微信用户（需排除）\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20230901' AND '20230921'\n      AND vgameappid = 'wx'\n);",
    "is_valid": true
  },
  {
    "sql_id": "sql_50",
    "sql": "WITH \n-- 1. 获取按钮点击用户及类型\nbutton_click AS (\n    SELECT \n        vplayerid,\n        MAX(CASE WHEN buttontype = '400211' THEN 1 ELSE 0 END) AS has_400211,\n        MAX(CASE WHEN buttontype = '400212' THEN 1 ELSE 0 END) AS has_400212\n    FROM dws_jordass_buttonpress_pre_di\n    WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n        AND buttontype IN ('400211', '400212')\n    GROUP BY vplayerid\n),\nuser_type_base AS (\n    SELECT \n        vplayerid,\n        CASE \n            WHEN has_400211 = 1 AND has_400212 = 1 THEN '400211&400212'\n            WHEN has_400211 = 1 THEN '400211'\n            WHEN has_400212 = 1 THEN '400212'\n            ELSE 'other'\n        END AS user_type\n    FROM button_click\n),\n-- 2. 获取玩家最新性别（假设从登录流水表获取，使用窗口函数）\nlatest_gender AS (\n    SELECT \n        vplayerid,\n        gender,\n        ROW_NUMBER() OVER (PARTITION BY vplayerid ORDER BY tdbank_imp_date DESC) AS rn\n    FROM dwd_jordass_playerlogin_hi\n    WHERE tdbank_imp_date BETWEEN '2024100100' AND '2024103123'\n),\ngender_info AS (\n    SELECT \n        vplayerid,\n        CASE \n            WHEN gender = 1 THEN 'male'\n            WHEN gender = 2 THEN 'female'\n            ELSE 'other'\n        END AS gender_type\n    FROM latest_gender\n    WHERE rn = 1\n),\n-- 3. 统计砺刃游戏活跃天数\ngame_activity AS (\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS active_days\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n    GROUP BY vplayerid\n),\ngame_activity_level AS (\n    SELECT \n        vplayerid,\n        CASE \n            WHEN active_days BETWEEN 1 AND 4 THEN 'light'\n            WHEN active_days BETWEEN 5 AND 15 THEN 'medium'\n            WHEN active_days >= 16 THEN 'heavy'\n            ELSE 'other'\n        END AS game_activity\n    FROM game_activity\n),\n-- 4. 统计乐园活跃天数\npark_activity AS (\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS active_days\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n        AND imode = 255\n    GROUP BY vplayerid\n),\npark_activity_level AS (\n    SELECT \n        vplayerid,\n        CASE \n            WHEN active_days BETWEEN 1 AND 4 THEN 'light'\n            WHEN active_days BETWEEN 5 AND 15 THEN 'medium'\n            WHEN active_days >= 16 THEN 'heavy'\n            ELSE 'other'\n        END AS park_activity\n    FROM park_activity\n)\n-- 5. 主查询：关联所有维度并统计\nSELECT \n    ut.user_type,\n    COALESCE(gi.gender_type, 'other') AS gender_type,\n    COALESCE(pal.park_activity, 'other') AS park_activity,\n    COALESCE(gal.game_activity, 'other') AS game_activity,\n    COUNT(DISTINCT ut.vplayerid) AS user_count\nFROM user_type_base ut\nLEFT JOIN gender_info gi ON ut.vplayerid = gi.vplayerid\nLEFT JOIN park_activity_level pal ON ut.vplayerid = pal.vplayerid\nLEFT JOIN game_activity_level gal ON ut.vplayerid = gal.vplayerid\nGROUP BY \n    ut.user_type,\n    COALESCE(gi.gender_type, 'other'),\n    COALESCE(pal.park_activity, 'other'),\n    COALESCE(gal.game_activity, 'other')\nORDER BY \n    ut.user_type,\n    gender_type,\n    park_activity,\n    game_activity;",
    "is_valid": true
  },
  {
    "sql_id": "sql_51",
    "sql": "WITH base_data AS (\n    SELECT \n        a.vplayerid,\n        CASE \n            WHEN a.dtstatdate BETWEEN '20241108' AND '20241121' THEN '时间段1'\n            WHEN a.dtstatdate BETWEEN '20241122' AND '20241204' THEN '时间段1'\n            WHEN a.dtstatdate BETWEEN '20241110' AND '20241123' THEN '时间段2'\n            WHEN a.dtstatdate BETWEEN '20241124' AND '20241204' THEN '时间段2'\n            WHEN a.dtstatdate BETWEEN '20241115' AND '20241128' THEN '时间段3'\n            WHEN a.dtstatdate BETWEEN '20241129' AND '20241204' THEN '时间段3'\n            WHEN a.dtstatdate BETWEEN '20241117' AND '20241130' THEN '时间段4'\n            WHEN a.dtstatdate BETWEEN '20241201' AND '20241204' THEN '时间段4'\n        END AS time_segment,\n        CASE \n            WHEN a.dtstatdate BETWEEN '20241108' AND '20241121' THEN 1\n            WHEN a.dtstatdate BETWEEN '20241110' AND '20241123' THEN 1\n            WHEN a.dtstatdate BETWEEN '20241115' AND '20241128' THEN 1\n            WHEN a.dtstatdate BETWEEN '20241117' AND '20241130' THEN 1\n            ELSE 2\n        END AS period_flag\n    FROM dws_jordass_buttonpress_pre_di a\n    INNER JOIN dim_jordass_submodeonlinedate_conf b\n        ON a.buttontype = b.matchsubmodegroup\n    WHERE a.dtstatdate BETWEEN '20241108' AND '20241204'\n        AND a.buttontype IS NOT NULL\n),\nuser_participation AS (\n    SELECT \n        time_segment,\n        vplayerid,\n        MAX(CASE WHEN period_flag = 1 THEN 1 ELSE 0 END) AS has_period1,\n        MAX(CASE WHEN period_flag = 2 THEN 1 ELSE 0 END) AS has_period2\n    FROM base_data\n    WHERE time_segment IS NOT NULL\n    GROUP BY time_segment, vplayerid\n)\nSELECT \n    time_segment AS 时间段,\n    COUNT(DISTINCT CASE WHEN has_period1 = 1 THEN vplayerid END) AS 第1个周期进入过灰度玩法的用户数,\n    COUNT(DISTINCT CASE WHEN has_period1 = 1 AND has_period2 = 1 THEN vplayerid END) AS 两个周期都进入过灰度的用户数\nFROM user_participation\nGROUP BY time_segment\nORDER BY time_segment;",
    "is_valid": true
  },
  {
    "sql_id": "sql_52",
    "sql": "WITH mode_total AS (\n    -- 计算每个子玩法的总对局数\n    SELECT \n        imode,\n        SUM(icnt) AS total_matches\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20241001' AND '20241008'\n        AND imode != 255\n    GROUP BY imode\n),\nmode_with_rank AS (\n    -- 计算排名和总数\n    SELECT \n        imode,\n        total_matches,\n        ROW_NUMBER() OVER (ORDER BY total_matches DESC) AS rn,\n        COUNT(*) OVER () AS total_modes\n    FROM mode_total\n),\nbottom_20_modes AS (\n    -- 筛选出后20%的子玩法\n    SELECT imode\n    FROM mode_with_rank\n    WHERE rn > total_modes * 0.8\n),\ntarget_users AS (\n    -- 找出参与了后20%子玩法的用户\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20241001' AND '20241008'\n        AND imode IN (SELECT imode FROM bottom_20_modes)\n),\ndaily_mode_count AS (\n    -- 统计这些用户每天参与的子玩法数量\n    SELECT \n        t1.dtstatdate,\n        t1.vplayerid,\n        COUNT(DISTINCT t1.imode) AS mode_count\n    FROM dws_jordass_matchlog_stat_di t1\n    INNER JOIN target_users t2 ON t1.vplayerid = t2.vplayerid\n    WHERE t1.dtstatdate BETWEEN '20241001' AND '20241008'\n        AND t1.imode != 255\n    GROUP BY t1.dtstatdate, t1.vplayerid\n)\n-- 最终统计：按日期和数量分布区间统计人数\nSELECT \n    dtstatdate AS 统计日期,\n    CASE \n        WHEN mode_count = 1 THEN '1'\n        WHEN mode_count = 2 THEN '2'\n        WHEN mode_count = 3 THEN '3'\n        WHEN mode_count = 4 THEN '4'\n        WHEN mode_count = 5 THEN '5'\n        WHEN mode_count BETWEEN 6 AND 10 THEN '6-10'\n        WHEN mode_count BETWEEN 11 AND 20 THEN '11-20'\n        WHEN mode_count >= 21 THEN '21以上'\n    END AS 数量分布,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM daily_mode_count\nGROUP BY dtstatdate, \n    CASE \n        WHEN mode_count = 1 THEN '1'\n        WHEN mode_count = 2 THEN '2'\n        WHEN mode_count = 3 THEN '3'\n        WHEN mode_count = 4 THEN '4'\n        WHEN mode_count = 5 THEN '5'\n        WHEN mode_count BETWEEN 6 AND 10 THEN '6-10'\n        WHEN mode_count BETWEEN 11 AND 20 THEN '11-20'\n        WHEN mode_count >= 21 THEN '21以上'\n    END\nORDER BY dtstatdate, \n    CASE 数量分布\n        WHEN '1' THEN 1\n        WHEN '2' THEN 2\n        WHEN '3' THEN 3\n        WHEN '4' THEN 4\n        WHEN '5' THEN 5\n        WHEN '6-10' THEN 6\n        WHEN '11-20' THEN 11\n        WHEN '21以上' THEN 21\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_53",
    "sql": "SELECT \n    COUNT(DISTINCT `vplayerid`) AS return_users,\n    SUM(CASE WHEN INSTR(SUBSTR(`cbitmap`, 40, 7), '1') > 0 THEN 1 ELSE 0 END) AS active_8_14_days,\n    SUM(CASE WHEN INSTR(SUBSTR(`cbitmap`, 47, 15), '1') > 0 THEN 1 ELSE 0 END) AS active_15_29_days,\n    SUM(CASE WHEN INSTR(SUBSTR(`cbitmap`, 62, 30), '1') > 0 THEN 1 ELSE 0 END) AS active_30_59_days,\n    SUM(CASE WHEN INSTR(SUBSTR(`cbitmap`, 92, 120), '1') > 0 THEN 1 ELSE 0 END) AS active_60_179_days,\n    SUM(CASE WHEN INSTR(SUBSTR(`cbitmap`, 212, 185), '1') > 0 THEN 1 ELSE 0 END) AS active_180_364_days\nFROM \n    `dws_jordass_login_df`\nWHERE \n    `dtstatdate` = '20241121'\n    AND `platid` = 255\n    AND `dregdate` < '20241021'\n    AND INSTR(SUBSTR(`cbitmap`, 1, 32), '1') > 0\n    AND INSTR(SUBSTR(`cbitmap`, 33, 7), '1') = 0;",
    "is_valid": true
  },
  {
    "sql_id": "sql_54",
    "sql": "WITH daily_play AS (\n    SELECT \n        SUBSTR(a.tdbank_imp_date, 1, 8) AS play_date,\n        a.vplayerid,\n        a.matchmode,\n        b.modename,\n        b.startdate,\n        b.enddate,\n        LEAD(SUBSTR(a.tdbank_imp_date, 1, 8)) OVER (PARTITION BY a.vplayerid, a.matchmode ORDER BY SUBSTR(a.tdbank_imp_date, 1, 8)) AS next_play_date\n    FROM dwd_jordass_player_matchrecord_hi a\n    INNER JOIN dim_jordass_imode_leyuan_nf b\n        ON a.matchmode = b.imode\n        AND SUBSTR(a.tdbank_imp_date, 1, 8) BETWEEN b.startdate AND b.enddate\n    WHERE a.tdbank_imp_date BETWEEN '2024092000' AND '2024102023'\n        AND a.matchmode = 1003\n        AND a.matchresult = '1'\n),\ndaily_metrics AS (\n    SELECT \n        modename,\n        startdate,\n        enddate,\n        play_date,\n        COUNT(DISTINCT vplayerid) AS daily_users,\n        COUNT(DISTINCT CASE \n            WHEN DATE_ADD(STR_TO_DATE(play_date, '%Y%m%d'), INTERVAL 1 DAY) = STR_TO_DATE(next_play_date, '%Y%m%d')\n            THEN vplayerid \n        END) AS daily_retention_users\n    FROM daily_play\n    GROUP BY modename, startdate, enddate, play_date\n)\nSELECT \n    modename AS 玩法,\n    startdate AS 上线日期,\n    enddate AS 下线日期,\n    ROUND(AVG(daily_users), 2) AS 日均参与人数,\n    ROUND(AVG(daily_retention_users), 2) AS 日均玩法次留\nFROM daily_metrics\nGROUP BY modename, startdate, enddate\nORDER BY modename;",
    "is_valid": true
  },
  {
    "sql_id": "sql_55",
    "sql": "WITH \n-- 第一步：获取每天每个玩法的基础指标\ndaily_metrics AS (\n  SELECT \n    m.dtstatdate,\n    m.imode,\n    d.matchsubmodegroupname,\n    -- 当天参与人数\n    COUNT(DISTINCT m.vplayerid) AS participate_users,\n    -- 当天活跃人数（登录）\n    COUNT(DISTINCT l.vplayerid) AS active_users,\n    -- 当天参与率\n    COUNT(DISTINCT m.vplayerid) * 1.0 / NULLIF(COUNT(DISTINCT l.vplayerid), 0) AS participation_rate\n  FROM dws_jordass_matchlog_stat_di m\n  INNER JOIN dws_jordass_login_di l\n    ON m.dtstatdate = l.dtstatdate\n    AND m.vgameappid = l.vgameappid\n    AND m.vplayerid = l.vplayerid\n    AND l.platid = 255\n  INNER JOIN dim_jordass_submodeonline_nf d\n    ON m.imode = d.matchsubmodegroup\n  WHERE m.dtstatdate BETWEEN '20241025' AND '20241130'\n    AND m.platid = 255\n    AND m.imode != 255\n    AND d.onlinedate >= DATE_SUB(DATE_FORMAT(m.dtstatdate, '%Y-%m-%d'), INTERVAL 180 DAY)\n  GROUP BY m.dtstatdate, m.imode, d.matchsubmodegroupname\n),\n\n-- 第二步：计算次留和七留\nretention_metrics AS (\n  SELECT \n    m1.dtstatdate,\n    m1.imode,\n    -- 次留：当天参与且次日也参与\n    COUNT(DISTINCT CASE \n      WHEN m2.vplayerid IS NOT NULL THEN m1.vplayerid \n    END) * 1.0 / NULLIF(COUNT(DISTINCT m1.vplayerid), 0) AS retention_d2,\n    -- 七留：当天参与且第7天也参与\n    COUNT(DISTINCT CASE \n      WHEN m7.vplayerid IS NOT NULL THEN m1.vplayerid \n    END) * 1.0 / NULLIF(COUNT(DISTINCT m1.vplayerid), 0) AS retention_d7\n  FROM dws_jordass_matchlog_stat_di m1\n  LEFT JOIN dws_jordass_matchlog_stat_di m2\n    ON m1.vgameappid = m2.vgameappid\n    AND m1.vplayerid = m2.vplayerid\n    AND m1.imode = m2.imode\n    AND m2.dtstatdate = DATE_FORMAT(DATE_ADD(DATE_FORMAT(m1.dtstatdate, '%Y-%m-%d'), INTERVAL 1 DAY), '%Y%m%d')\n    AND m2.platid = 255\n    AND m2.imode != 255\n  LEFT JOIN dws_jordass_matchlog_stat_di m7\n    ON m1.vgameappid = m7.vgameappid\n    AND m1.vplayerid = m7.vplayerid\n    AND m1.imode = m7.imode\n    AND m7.dtstatdate = DATE_FORMAT(DATE_ADD(DATE_FORMAT(m1.dtstatdate, '%Y-%m-%d'), INTERVAL 7 DAY), '%Y%m%d')\n    AND m7.platid = 255\n    AND m7.imode != 255\n  WHERE m1.dtstatdate BETWEEN '20241025' AND '20241130'\n    AND m1.platid = 255\n    AND m1.imode != 255\n  GROUP BY m1.dtstatdate, m1.imode\n),\n\n-- 第三步：合并指标并计算7天移动平均\navg_metrics AS (\n  SELECT \n    dm.dtstatdate,\n    dm.imode,\n    dm.matchsubmodegroupname,\n    -- 7天平均参与率\n    AVG(dm.participation_rate) OVER (\n      PARTITION BY dm.imode \n      ORDER BY dm.dtstatdate \n      ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS avg_7d_participation_rate,\n    -- 7天平均次留\n    AVG(rm.retention_d2) OVER (\n      PARTITION BY dm.imode \n      ORDER BY dm.dtstatdate \n      ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS avg_7d_retention_d2,\n    -- 7天平均七留\n    AVG(rm.retention_d7) OVER (\n      PARTITION BY dm.imode \n      ORDER BY dm.dtstatdate \n      ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS avg_7d_retention_d7\n  FROM daily_metrics dm\n  LEFT JOIN retention_metrics rm\n    ON dm.dtstatdate = rm.dtstatdate\n    AND dm.imode = rm.imode\n),\n\n-- 第四步：计算排名\nranked_metrics AS (\n  SELECT \n    dtstatdate AS 统计日期,\n    matchsubmodegroupname AS 玩法名,\n    avg_7d_participation_rate,\n    avg_7d_retention_d2,\n    avg_7d_retention_d7,\n    RANK() OVER (PARTITION BY dtstatdate ORDER BY avg_7d_participation_rate DESC) AS 参与率排名,\n    RANK() OVER (PARTITION BY dtstatdate ORDER BY avg_7d_retention_d2 DESC) AS 次留排名,\n    RANK() OVER (PARTITION BY dtstatdate ORDER BY avg_7d_retention_d7 DESC) AS 七留排名\n  FROM avg_metrics\n  WHERE dtstatdate BETWEEN '20241101' AND '20241130'  -- 只输出统计期内的数据\n)\n\n-- 第五步：计算总排名并输出\nSELECT \n  统计日期,\n  玩法名,\n  参与率排名,\n  次留排名,\n  七留排名,\n  (参与率排名 + 次留排名 + 七留排名) AS 总排名\nFROM ranked_metrics\nORDER BY 统计日期, 总排名, 玩法名;",
    "is_valid": true
  },
  {
    "sql_id": "sql_58",
    "sql": "SELECT \n    `imode` AS 玩法id,\n    CASE \n        WHEN `itemp1`/60 >= 0 AND `itemp1`/60 < 10 THEN '[0-10min)'\n        WHEN `itemp1`/60 >= 10 AND `itemp1`/60 < 30 THEN '[10-30min)'\n        WHEN `itemp1`/60 >= 30 AND `itemp1`/60 < 60 THEN '[30min-1h)'\n        WHEN `itemp1`/60 >= 60 AND `itemp1`/60 < 120 THEN '[1h,2h)'\n        WHEN `itemp1`/60 >= 120 AND `itemp1`/60 < 180 THEN '[2h,3h)'\n        WHEN `itemp1`/60 >= 180 AND `itemp1`/60 < 240 THEN '[3h,4h)'\n        WHEN `itemp1`/60 >= 240 AND `itemp1`/60 < 300 THEN '[4h,5h)'\n        WHEN `itemp1`/60 >= 300 AND `itemp1`/60 < 360 THEN '[5h,6h)'\n        WHEN `itemp1`/60 >= 360 AND `itemp1`/60 < 420 THEN '[6h,7h)'\n        WHEN `itemp1`/60 >= 420 AND `itemp1`/60 < 480 THEN '[7h,8h)'\n        WHEN `itemp1`/60 >= 480 AND `itemp1`/60 < 540 THEN '[8h,9h)'\n        WHEN `itemp1`/60 >= 540 AND `itemp1`/60 < 600 THEN '[9h,10h)'\n        WHEN `itemp1`/60 >= 600 THEN '[10h,∞)'\n    END AS 对局时长,\n    COUNT(DISTINCT `vplayerid`) AS 人数\nFROM `dws_jordass_matchlog_stat_di`\nWHERE (\n    (`dtstatdate` BETWEEN '20240717' AND '20240723' AND `imode` = 1310822585431254784)\n    OR (`dtstatdate` BETWEEN '20241116' AND '20241122' AND `imode` = 1282371711108385024)\n    OR (`dtstatdate` BETWEEN '20241123' AND '20241129' AND `imode` = 1287652322611036928)\n    OR (`dtstatdate` BETWEEN '20240301' AND '20240307' AND `imode` = 1294211358396518400)\n    OR (`dtstatdate` BETWEEN '20240607' AND '20240613' AND `imode` = 1297394991875754752)\n)\nGROUP BY \n    `imode`,\n    CASE \n        WHEN `itemp1`/60 >= 0 AND `itemp1`/60 < 10 THEN '[0-10min)'\n        WHEN `itemp1`/60 >= 10 AND `itemp1`/60 < 30 THEN '[10-30min)'\n        WHEN `itemp1`/60 >= 30 AND `itemp1`/60 < 60 THEN '[30min-1h)'\n        WHEN `itemp1`/60 >= 60 AND `itemp1`/60 < 120 THEN '[1h,2h)'\n        WHEN `itemp1`/60 >= 120 AND `itemp1`/60 < 180 THEN '[2h,3h)'\n        WHEN `itemp1`/60 >= 180 AND `itemp1`/60 < 240 THEN '[3h,4h)'\n        WHEN `itemp1`/60 >= 240 AND `itemp1`/60 < 300 THEN '[4h,5h)'\n        WHEN `itemp1`/60 >= 300 AND `itemp1`/60 < 360 THEN '[5h,6h)'\n        WHEN `itemp1`/60 >= 360 AND `itemp1`/60 < 420 THEN '[6h,7h)'\n        WHEN `itemp1`/60 >= 420 AND `itemp1`/60 < 480 THEN '[7h,8h)'\n        WHEN `itemp1`/60 >= 480 AND `itemp1`/60 < 540 THEN '[8h,9h)'\n        WHEN `itemp1`/60 >= 540 AND `itemp1`/60 < 600 THEN '[9h,10h)'\n        WHEN `itemp1`/60 >= 600 THEN '[10h,∞)'\n    END\nORDER BY `imode`, 对局时长;",
    "is_valid": true
  },
  {
    "sql_id": "sql_60",
    "sql": "SELECT \n    dws_jordass_water_di.dtstatdate AS stat_date,\n    COUNT(DISTINCT CASE \n        WHEN datediff(dws_jordass_water_di.dtstatdate, dwd_jordass_player_allianceactive_hi.tdbank_imp_date) BETWEEN 0 AND 29 \n        THEN dwd_jordass_player_allianceactive_hi.uid \n    END) AS pay_user_count\nFROM dws_jordass_water_di\nINNER JOIN dwd_jordass_player_allianceactive_hi\n    ON dws_jordass_water_di.vplayerid = dwd_jordass_player_allianceactive_hi.uid\nWHERE dws_jordass_water_di.dtstatdate >= date_sub('20250226', 210) \n    AND dws_jordass_water_di.dtstatdate < '20250226'\n    AND dws_jordass_water_di.platid = 255\n    AND dwd_jordass_player_allianceactive_hi.tdbank_imp_date >= date_sub('20250226', 180)\n    AND dwd_jordass_player_allianceactive_hi.tdbank_imp_date < '20250226'\nGROUP BY dws_jordass_water_di.dtstatdate\nORDER BY dws_jordass_water_di.dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_61",
    "sql": "WITH \n-- 领奖玩家（活动参与者）\nreward_players AS (\n  SELECT DISTINCT vplayerid\n  FROM dwd_jordass_currencylog_hi\n  WHERE tdbank_imp_date BETWEEN '2024020900' AND '2024020923'\n    AND reason = 2402096612\n    AND subreason BETWEEN 1 AND 7\n    AND imoneytype = 1\n),\n\n-- 历史付费玩家标记\nhistorical_payers AS (\n  SELECT DISTINCT vplayerid\n  FROM dws_jordass_water_df\n  WHERE dtstatdate <= '20240209'\n),\n\n-- 前一个月点券消耗金额（按玩家聚合）\nprev_month_券 AS (\n  SELECT \n    vplayerid,\n    SUM(imoney) AS total_券消耗\n  FROM dwd_jordass_currencylog_hi\n  WHERE tdbank_imp_date BETWEEN '2024010900' AND '2024020823'\n    AND imoneytype = 1\n    AND addorreduce = 1\n  GROUP BY vplayerid\n),\n\n-- 首日付费数据（按玩家聚合）\nfirst_day_pay AS (\n  SELECT \n    vplayerid,\n    SUM(imoney) AS total_券充值\n  FROM dwd_jordass_currencylog_hi\n  WHERE tdbank_imp_date BETWEEN '2024020900' AND '2024020923'\n    AND imoneytype = 1\n    AND addorreduce = 0\n  GROUP BY vplayerid\n)\n\nSELECT \n  CASE \n    WHEN hp.vplayerid IS NOT NULL AND pm.vplayerid IS NULL THEN '沉默付费'\n    WHEN hp.vplayerid IS NULL THEN '历史非付费'\n    WHEN pm.total_券消耗 / 10 < 100 THEN '小R'\n    WHEN pm.total_券消耗 / 10 >= 100 AND pm.total_券消耗 / 10 < 500 THEN '中R'\n    WHEN pm.total_券消耗 / 10 >= 500 AND pm.total_券消耗 / 10 < 1500 THEN '大R'\n    WHEN pm.total_券消耗 / 10 >= 1500 THEN '超R'\n    ELSE '未分类'\n  END AS user_type,\n  COUNT(DISTINCT rp.vplayerid) AS active_users,\n  COUNT(DISTINCT fdp.vplayerid) AS first_day_payers,\n  COALESCE(SUM(fdp.total_券充值) / 10.0 / NULLIF(COUNT(DISTINCT fdp.vplayerid), 0), 0) AS first_day_arpu,\n  COUNT(DISTINCT pm.vplayerid) AS prev_month_券_users\nFROM reward_players rp\nLEFT JOIN historical_payers hp ON rp.vplayerid = hp.vplayerid\nLEFT JOIN prev_month_券 pm ON rp.vplayerid = pm.vplayerid\nLEFT JOIN first_day_pay fdp ON rp.vplayerid = fdp.vplayerid\nGROUP BY user_type\nORDER BY \n  CASE user_type\n    WHEN '沉默付费' THEN 1\n    WHEN '历史非付费' THEN 2\n    WHEN '小R' THEN 3\n    WHEN '中R' THEN 4\n    WHEN '大R' THEN 5\n    WHEN '超R' THEN 6\n    ELSE 7\n  END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_62",
    "sql": "WITH \n-- 角色DAU\nrole_dau AS (\n  SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT uid) AS role_dau\n  FROM dwd_jordass_playerlogin_hi\n  WHERE tdbank_imp_date BETWEEN '2024083000' AND '2025022623'\n    AND vgameappid = 'jordass'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8)\n),\n-- 联盟参与角色数\nalliance_active AS (\n  SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT uid) AS alliance_active_roles\n  FROM dwd_jordass_player_allianceactive_hi\n  WHERE tdbank_imp_date BETWEEN '2024083000' AND '2025022623'\n    AND vgameappid = 'jordass'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8)\n),\n-- 联盟完成特训任务角色数\nalliance_train AS (\n  SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT memberuid) AS alliance_train_complete_roles\n  FROM dwd_jordass_alliancebootcamprecord_hi\n  WHERE tdbank_imp_date BETWEEN '2024083000' AND '2025022623'\n    AND vgameappid = 'jordass'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8)\n),\n-- 联盟商店兑换次数\nalliance_shop AS (\n  SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(1) AS alliance_shop_exchange_count\n  FROM dwd_jordass_allianceshopbuy_hi\n  WHERE tdbank_imp_date BETWEEN '2024083000' AND '2025022623'\n    AND vgameappid = 'jordass'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8)\n)\nSELECT \n  COALESCE(d.stat_date, a.stat_date, t.stat_date, s.stat_date) AS stat_date,\n  COALESCE(d.role_dau, 0) AS role_dau,\n  COALESCE(a.alliance_active_roles, 0) AS alliance_active_roles,\n  COALESCE(t.alliance_train_complete_roles, 0) AS alliance_train_complete_roles,\n  COALESCE(s.alliance_shop_exchange_count, 0) AS alliance_shop_exchange_count\nFROM role_dau d\nFULL OUTER JOIN alliance_active a ON d.stat_date = a.stat_date\nFULL OUTER JOIN alliance_train t ON COALESCE(d.stat_date, a.stat_date) = t.stat_date\nFULL OUTER JOIN alliance_shop s ON COALESCE(d.stat_date, a.stat_date, t.stat_date) = s.stat_date\nORDER BY stat_date;",
    "is_valid": true
  },
  {
    "sql_id": "sql_64",
    "sql": "SELECT \n    dtstatdate AS 统计日期,\n    COUNT(DISTINCT vplayerid) AS UV,\n    COUNT(1) AS PV\nFROM \n    dws_jordass_buttonpress_pre_di\nWHERE \n    buttontype = '410012'\n    AND (\n        (dtstatdate BETWEEN '20241022' AND '20241119')\n        OR (dtstatdate BETWEEN '20241122' AND '20241219')\n    )\nGROUP BY \n    dtstatdate\nORDER BY \n    dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_65",
    "sql": "SELECT \n    DATE_FORMAT(`dteventtime`, '%Y%m%d') AS stat_date,\n    `awardidx` AS award_type,\n    COUNT(DISTINCT `vplayerid`) AS user_count,\n    COUNT(1) AS receive_count\nFROM \n    dwd_jordass_activity_rewardrecord_hi\nWHERE \n    `dteventtime` BETWEEN '2024-11-29 00:00:00' AND '2024-12-19 23:59:59'\n    AND `actid` = 2411291018\n    AND `acttype` = 10045\n    AND `awardidx` IN (1, 2, 3)\nGROUP BY \n    DATE_FORMAT(`dteventtime`, '%Y%m%d'),\n    `awardidx`\nORDER BY \n    stat_date,\n    award_type;",
    "is_valid": true
  },
  {
    "sql_id": "sql_67",
    "sql": "SELECT \n    igoodsid AS 道具id,\n    COUNT(1) AS 产出次数\nFROM \n    dwd_jordass_gearlog_hi\nWHERE \n    tdbank_imp_date BETWEEN '2025012400' AND '2025020623'\n    AND igoodsid IN (430487, 430485, 602004025, 602002011)\n    AND addorreduce = 0\nGROUP BY \n    igoodsid\nORDER BY \n    产出次数 DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_68",
    "sql": "SELECT \n    SUBSTR(SUBSTR(tdbank_imp_date, 1, 8), 3, 6) AS date_yymmdd,\n    COUNT(DISTINCT vplayerid) AS player_count\nFROM \n    dwd_jordass_lotteryrecord_hi\nWHERE \n    tdbank_imp_date BETWEEN '2025012800' AND '2025021023'\n    AND activitytype IN (848, 841)\nGROUP BY \n    SUBSTR(tdbank_imp_date, 1, 8)\nORDER BY \n    SUBSTR(tdbank_imp_date, 1, 8);",
    "is_valid": true
  },
  {
    "sql_id": "sql_69",
    "sql": "SELECT \n    tdbank_imp_date AS `日期`,\n    chattype AS `信息类型`,\n    COUNT(DISTINCT playerid) AS `人数`,\n    COUNT(1) AS `次数`\nFROM \n    dwd_jordass_msgchatrecord_hi\nWHERE \n    tdbank_imp_date BETWEEN '20241225' AND '20250105'\n    AND chattype IN (20, 25, 26, 16, 27, 8)\nGROUP BY \n    tdbank_imp_date,\n    chattype\nORDER BY \n    tdbank_imp_date,\n    chattype;",
    "is_valid": true
  },
  {
    "sql_id": "sql_70",
    "sql": "SELECT \n    CAST(awardidx AS STRING) AS awardidx,\n    user_count\nFROM (\n    -- 各档位统计\n    SELECT \n        awardidx,\n        COUNT(DISTINCT vplayerid) AS user_count\n    FROM dwd_jordass_activity_rewardrecord_hi\n    WHERE tdbank_imp_date BETWEEN '2024112900' AND '2024121923'\n        AND actid = 2411291018\n    GROUP BY awardidx\n    \n    UNION ALL\n    \n    -- 汇总统计\n    SELECT \n        -1 AS awardidx,\n        COUNT(DISTINCT vplayerid) AS user_count\n    FROM dwd_jordass_activity_rewardrecord_hi\n    WHERE tdbank_imp_date BETWEEN '2024112900' AND '2024121923'\n        AND actid = 2411291018\n) t\nORDER BY \n    CASE WHEN awardidx = -1 THEN 999999 ELSE awardidx END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_71",
    "sql": "SELECT \n    CASE \n        WHEN tdbank_imp_date BETWEEN '2024112900' AND '2024120523' THEN '20241129-20241205'\n        WHEN tdbank_imp_date BETWEEN '2024120600' AND '2024121223' THEN '20241206-20241212'\n        WHEN tdbank_imp_date BETWEEN '2024121300' AND '2024121923' THEN '20241213-20241219'\n    END AS date_range,\n    extarg1,\n    COUNT(DISTINCT vplayerid) AS user_count,\n    COUNT(1) AS click_count\nFROM dwd_jordass_activitypress_hi\nWHERE tdbank_imp_date BETWEEN '2024112900' AND '2024121923'\n    AND ireason = 2411291018\n    AND buttontype = 10045\n    AND extarg1 IN (101, 109, 110)\nGROUP BY \n    CASE \n        WHEN tdbank_imp_date BETWEEN '2024112900' AND '2024120523' THEN '20241129-20241205'\n        WHEN tdbank_imp_date BETWEEN '2024120600' AND '2024121223' THEN '20241206-20241212'\n        WHEN tdbank_imp_date BETWEEN '2024121300' AND '2024121923' THEN '20241213-20241219'\n    END,\n    extarg1\nORDER BY date_range, extarg1;",
    "is_valid": true
  },
  {
    "sql_id": "sql_73",
    "sql": "SELECT \n    COUNT(DISTINCT CASE WHEN matchmode = 1003 THEN vplayerid END) AS 乐园总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 THEN 1 END) AS 乐园总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND teamnum > 1 THEN vplayerid END) AS 乐园组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND teamnum > 1 THEN 1 END) AS 乐园组队局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 THEN vplayerid END) AS 对决冠军总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 THEN 1 END) AS 对决冠军总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND teamnum > 1 THEN vplayerid END) AS 对决冠军组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND teamnum > 1 THEN 1 END) AS 对决冠军组队局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup <> 1345785623905087744 THEN vplayerid END) AS 乐园其他总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup <> 1345785623905087744 THEN 1 END) AS 乐园其他总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup <> 1345785623905087744 AND teamnum > 1 THEN vplayerid END) AS 乐园其他组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup <> 1345785623905087744 AND teamnum > 1 THEN 1 END) AS 乐园其他组队局数\nFROM dwd_jordass_player_matchrecord_hi\nWHERE tdbank_imp_date BETWEEN '2024112300' AND '2024122223'\n    AND matchresult = 'ok';",
    "is_valid": true
  },
  {
    "sql_id": "sql_74",
    "sql": "SELECT \n    buttontypes AS 按钮类型,\n    COUNT(DISTINCT CASE \n        WHEN tdbank_imp_date BETWEEN '2024112305' AND '2024112616' \n        THEN vplayerid \n    END) AS SS30赛季手册人数,\n    COUNT(DISTINCT CASE \n        WHEN tdbank_imp_date BETWEEN '2024092405' AND '2024092716' \n        THEN vplayerid \n    END) AS SS29赛季手册人数\nFROM dwd_jordass_pressbutton_hi\nWHERE buttontypes IN ('411130', '411200')\n    AND (\n        tdbank_imp_date BETWEEN '2024112305' AND '2024112616'\n        OR tdbank_imp_date BETWEEN '2024092405' AND '2024092716'\n    )\nGROUP BY buttontypes;",
    "is_valid": true
  },
  {
    "sql_id": "sql_75",
    "sql": "SELECT \n    baseid,\n    COUNT(1) AS unlock_count\nFROM \n    dwd_jordass_voicethemelog_hi\nWHERE \n    tdbank_imp_date BETWEEN '2022080400' AND '2024112400'\n    AND baseid IN (3336008, 3304024, 3336012, 3306028, 3304030, 3336016, 3336018, 3304038, 3336023, 3306033, 3349004, 3308014, 3336032, 3304043, 3306039, 3336041, 3301024, 3336045, 3306042)\nGROUP BY \n    baseid\nORDER BY \n    baseid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_77",
    "sql": "SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT vplayerid) AS user_count,\n    SUM(imoney) AS total_element_pay\nFROM \n    dwd_jordass_currencylog_hi\nWHERE \n    tdbank_imp_date BETWEEN '2023012300' AND '2023012923'\n    AND reason IN (189, 190)\n    AND imoneytype = 1027\nGROUP BY \n    SUBSTR(tdbank_imp_date, 1, 8)\nORDER BY \n    stat_date;",
    "is_valid": true
  },
  {
    "sql_id": "sql_78",
    "sql": "WITH \n-- 初日华服回归抽奖用户（20250119）\nlottery_815 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date >= '2025011900' \n      AND tdbank_imp_date <= '2025011923'\n      AND activitytype = 815\n),\n-- 沙漠统治者抽奖用户\nlottery_690 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date >= '2024042600' \n      AND tdbank_imp_date <= '2024060623'\n      AND activitytype = 690\n),\n-- 境界双花抽奖用户\nlottery_748 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date >= '2024060700' \n      AND tdbank_imp_date <= '2024072523'\n      AND activitytype = 748\n),\n-- 玄龙凌霄抽奖用户\nlottery_750 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date >= '2024072600' \n      AND tdbank_imp_date <= '2024082223'\n      AND activitytype = 750\n),\n-- 沙漠统治者主套获取用户\ngear_430179 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE tdbank_imp_date >= '2024042600' \n      AND tdbank_imp_date <= '2024060623'\n      AND igoodsid = 430179 \n      AND addorreduce = 0\n),\n-- 境界双花主套获取用户\ngear_430265 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE tdbank_imp_date >= '2024060700' \n      AND tdbank_imp_date <= '2024072523'\n      AND igoodsid = 430265 \n      AND addorreduce = 0\n),\n-- 玄龙凌霄主套获取用户\ngear_430225 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE tdbank_imp_date >= '2024072600' \n      AND tdbank_imp_date <= '2024082223'\n      AND igoodsid = 430225 \n      AND addorreduce = 0\n)\n\nSELECT \n    COUNT(DISTINCT CASE WHEN lottery_690.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&沙漠统治者有抽奖人数`,\n    COUNT(DISTINCT CASE WHEN lottery_748.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&境界双花有抽奖人数`,\n    COUNT(DISTINCT CASE WHEN lottery_750.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&玄龙凌霄有抽奖人数`,\n    COUNT(DISTINCT CASE WHEN lottery_690.vplayerid IS NOT NULL AND gear_430179.vplayerid IS NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&沙漠统治者有抽奖&但没有其主套人数`,\n    COUNT(DISTINCT CASE WHEN lottery_748.vplayerid IS NOT NULL AND gear_430265.vplayerid IS NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&境界双花有抽奖&但没有其主套人数`,\n    COUNT(DISTINCT CASE WHEN lottery_750.vplayerid IS NOT NULL AND gear_430225.vplayerid IS NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&玄龙凌霄有抽奖&但没有其主套人数`,\n    COUNT(DISTINCT CASE WHEN gear_430179.vplayerid IS NOT NULL AND gear_430265.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&沙漠统治者和境界双花有主套人数`,\n    COUNT(DISTINCT CASE WHEN gear_430179.vplayerid IS NOT NULL AND gear_430225.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&沙漠统治者和玄龙凌霄有主套人数`,\n    COUNT(DISTINCT CASE WHEN gear_430265.vplayerid IS NOT NULL AND gear_430225.vplayerid IS NOT NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖&境界双花和玄龙凌霄有主套人数`,\n    COUNT(DISTINCT CASE WHEN lottery_690.vplayerid IS NULL AND lottery_748.vplayerid IS NULL AND lottery_750.vplayerid IS NULL THEN lottery_815.vplayerid END) AS `初日华服回归抽奖但沙漠统治者&境界双花&玄龙凌霄没有抽奖人数`\nFROM lottery_815\nLEFT JOIN lottery_690 ON lottery_815.vplayerid = lottery_690.vplayerid\nLEFT JOIN lottery_748 ON lottery_815.vplayerid = lottery_748.vplayerid\nLEFT JOIN lottery_750 ON lottery_815.vplayerid = lottery_750.vplayerid\nLEFT JOIN gear_430179 ON lottery_815.vplayerid = gear_430179.vplayerid\nLEFT JOIN gear_430265 ON lottery_815.vplayerid = gear_430265.vplayerid\nLEFT JOIN gear_430225 ON lottery_815.vplayerid = gear_430225.vplayerid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_80",
    "sql": "WITH base_data AS (\n    -- 基础数据：添加周期标识和玩法分类\n    SELECT \n        dtstatdate,\n        vplayerid,\n        -- 计算周期编号（从2024-10-02开始，每7天一个周期）\n        FLOOR(DATEDIFF(DATE_FORMAT(dtstatdate, '%Y-%m-%d'), '2024-10-02') / 7) AS week_num,\n        CASE \n            WHEN modename='传统模式' AND submodename LIKE 'CG%' AND mapname='群屿' THEN '主题群屿'\n            WHEN modename='传统模式' AND mapname='群屿' THEN '传统群屿'\n            WHEN modename='传统模式' AND mapname='假日群岛' THEN '假日群岛'\n            WHEN submodename='广域战场模式' THEN '广域战场'\n            WHEN submodename='极能形态模式' THEN '极能形态'\n            WHEN modename='组队竞技' THEN '组竞'\n            WHEN modename='休闲模式' THEN '休闲'\n            WHEN modename='乐园' THEN '乐园'\n            WHEN modename='领地' THEN '领地'\n            WHEN modename='广阔天地' THEN '广阔天地'\n            WHEN modename='生存模式' THEN '隧道'\n            ELSE '其他模式'\n        END AS mode_category,\n        CASE WHEN modename='乐园' AND submodename='对决冠军' THEN 1 ELSE 0 END AS is_champion,\n        roundtime\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20241002' AND '20250108'\n),\n\n-- 识别每周参与对决冠军的用户\nchampion_users AS (\n    SELECT DISTINCT\n        week_num,\n        vplayerid\n    FROM base_data\n    WHERE is_champion = 1\n),\n\n-- 找出上周未参与但本周参与对决冠军的用户（每个周期对）\ntarget_users AS (\n    SELECT \n        curr.week_num AS curr_week,\n        curr.vplayerid\n    FROM champion_users curr\n    LEFT JOIN champion_users prev \n        ON curr.vplayerid = prev.vplayerid \n        AND prev.week_num = curr.week_num - 1\n    WHERE prev.vplayerid IS NULL  -- 上周未参与\n        AND curr.week_num > 0  -- 排除第0周（无上周数据）\n),\n\n-- 计算每个用户每周每个玩法的时长\nuser_mode_playtime AS (\n    SELECT \n        b.week_num,\n        b.vplayerid,\n        b.mode_category,\n        SUM(b.roundtime) AS total_seconds,\n        SUM(CASE WHEN b.is_champion = 1 THEN b.roundtime ELSE 0 END) AS champion_seconds\n    FROM base_data b\n    INNER JOIN target_users t \n        ON b.vplayerid = t.vplayerid \n        AND (b.week_num = t.curr_week OR b.week_num = t.curr_week - 1)\n    GROUP BY b.week_num, b.vplayerid, b.mode_category\n),\n\n-- 确定每个用户每周的主玩玩法\nmain_mode AS (\n    SELECT \n        week_num,\n        vplayerid,\n        mode_category AS main_mode,\n        total_seconds,\n        ROW_NUMBER() OVER (PARTITION BY week_num, vplayerid ORDER BY total_seconds DESC, mode_category) AS rn\n    FROM user_mode_playtime\n),\n\n-- 汇总每个用户每周的统计数据\nweekly_stats AS (\n    SELECT \n        ump.week_num,\n        ump.vplayerid,\n        mm.main_mode,\n        ROUND(SUM(ump.total_seconds) / 3600.0, 2) AS total_play_hours,\n        ROUND(SUM(ump.champion_seconds) / 3600.0, 2) AS champion_hours,\n        ROUND(MAX(CASE WHEN mm.rn = 1 THEN ump.total_seconds ELSE 0 END) / 3600.0, 2) AS main_mode_hours\n    FROM user_mode_playtime ump\n    LEFT JOIN main_mode mm \n        ON ump.week_num = mm.week_num \n        AND ump.vplayerid = mm.vplayerid \n        AND ump.mode_category = mm.main_mode\n    GROUP BY ump.week_num, ump.vplayerid, mm.main_mode\n)\n\n-- 最终输出\nSELECT \n    CONCAT(\n        DATE_FORMAT(DATE_ADD('2024-10-02', INTERVAL (curr.week_num - 1) * 7 DAY), '%Y-%m-%d'),\n        ' - ',\n        DATE_FORMAT(DATE_ADD('2024-10-02', INTERVAL curr.week_num * 7 - 1 DAY), '%Y-%m-%d')\n    ) AS time_range,\n    prev.main_mode AS prev_main_mode,\n    prev.total_play_hours AS prev_total_hours,\n    curr.main_mode AS curr_main_mode,\n    curr.total_play_hours AS curr_total_hours,\n    curr.champion_hours AS curr_champion_hours\nFROM target_users t\nINNER JOIN weekly_stats curr \n    ON t.vplayerid = curr.vplayerid \n    AND t.curr_week = curr.week_num\nINNER JOIN weekly_stats prev \n    ON t.vplayerid = prev.vplayerid \n    AND t.curr_week - 1 = prev.week_num\nORDER BY time_range, t.vplayerid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_82",
    "sql": "SELECT \n    CASE \n        WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN '群屿'\n        WHEN submode IN (2160, 2161, 2162, 2163, 2164, 2165, 2334, 2335, 2336, 2337, 2338, 2339) THEN '山峦'\n        WHEN submode IN (2396, 2397, 2398, 2399, 2400, 2401) THEN '假日群岛'\n    END AS `玩法类型`,\n    newsegmentlevel AS `赛季等级`,\n    CONCAT('[', \n           CAST(FLOOR(CASE \n               WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN totalpoint * 1.2\n               ELSE totalpoint * 1\n           END) AS STRING),\n           ', ',\n           CAST(FLOOR(CASE \n               WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN totalpoint * 1.2\n               ELSE totalpoint * 1\n           END) + 1 AS STRING),\n           ')') AS `总积分范围`,\n    COUNT(DISTINCT vplayerid) AS `人数`\nFROM dwd_jordass_roundflow_hi\nWHERE tdbank_imp_date BETWEEN '2022040800' AND '2022041023'\n    AND mode = 103\n    AND submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468, 2160, 2161, 2162, 2163, 2164, 2165, 2334, 2335, 2336, 2337, 2338, 2339, 2396, 2397, 2398, 2399, 2400, 2401)\nGROUP BY \n    CASE \n        WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN '群屿'\n        WHEN submode IN (2160, 2161, 2162, 2163, 2164, 2165, 2334, 2335, 2336, 2337, 2338, 2339) THEN '山峦'\n        WHEN submode IN (2396, 2397, 2398, 2399, 2400, 2401) THEN '假日群岛'\n    END,\n    newsegmentlevel,\n    FLOOR(CASE \n        WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN totalpoint * 1.2\n        ELSE totalpoint * 1\n    END)\nORDER BY `玩法类型`, `赛季等级`, FLOOR(CASE \n    WHEN submode IN (1001, 1002, 1003, 1064, 1065, 1066, 1076, 1077, 1078, 1091, 1092, 1093, 1137, 1138, 1139, 1143, 1144, 1145, 1152, 1153, 1154, 1158, 1159, 1160, 2029, 2030, 2031, 2044, 2045, 2046, 2122, 2123, 2124, 2129, 2130, 2131, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2203, 2216, 2217, 2218, 2219, 2220, 2221, 2297, 2298, 2299, 2300, 2301, 2302, 2304, 2305, 2306, 2322, 2323, 2324, 2325, 2326, 2327, 2359, 2360, 2361, 2368, 2367, 2366, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427, 2453, 2454, 2455, 2460, 2461, 2462, 2472, 2473, 2474, 2463, 2464, 2465, 2466, 2467, 2468) THEN totalpoint * 1.2\n    ELSE totalpoint * 1\nEND);",
    "is_valid": true
  },
  {
    "sql_id": "sql_83",
    "sql": "SELECT \n    a.dtstatdate AS stat_date,\n    '流失14天以上的回流用户' AS user_type,\n    COUNT(DISTINCT a.vplayerid) AS return_user_count,\n    COUNT(DISTINCT CASE WHEN b.buttontype = '10370' THEN b.vplayerid END) AS gift_click_users,\n    COUNT(DISTINCT CASE WHEN b.buttontype IN ('10373', '10374') THEN b.vplayerid END) AS lobby_return_users,\n    COUNT(DISTINCT c.vplayerid) AS paradise_match_users\nFROM (\n    SELECT \n        dtstatdate,\n        vplayerid\n    FROM dws_jordass_login_df\n    WHERE dtstatdate IN ('20240102', '20231219', '20231212', '20231205', '20231010', '20230919', '20230103', '20221220')\n        AND platid = 255\n        AND SUBSTR(cbitmap, 1, 1) = '1'\n        AND INSTR(SUBSTR(cbitmap, 2, 14), '1') = 0\n        AND INSTR(SUBSTR(cbitmap, 16, 85), '1') > 0\n) a\nLEFT JOIN (\n    SELECT \n        dtstatdate,\n        vplayerid,\n        buttontype\n    FROM dws_jordass_buttonpress_pre_di\n    WHERE dtstatdate IN ('20240102', '20231219', '20231212', '20231205', '20231010', '20230919', '20230103', '20221220')\n        AND buttontype IN ('10370', '10373', '10374')\n) b ON a.vplayerid = b.vplayerid AND a.dtstatdate = b.dtstatdate\nLEFT JOIN (\n    SELECT \n        dtstatdate,\n        vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate IN ('20240102', '20231219', '20231212', '20231205', '20231010', '20230919', '20230103', '20221220')\n        AND imode = 255\n) c ON a.vplayerid = c.vplayerid AND a.dtstatdate = c.dtstatdate\nGROUP BY a.dtstatdate\nORDER BY a.dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_84",
    "sql": "SELECT \n    SUBSTR(f.tdbank_imp_date, 1, 6) AS stat_month,\n    SUM(l.friendcount) / COUNT(DISTINCT l.vplayerid) AS avg_online_friends\nFROM dwd_jordass_friendlist_hi f\nINNER JOIN dws_jordass_login_df l\n    ON f.vplayerid = l.vplayerid\nWHERE f.tdbank_imp_date BETWEEN '2020090100' AND '2022043023'\n    AND f.type = 2\n    AND l.dtstatdate = '20241210'\n    AND l.platid = 255\n    AND l.dregdate BETWEEN '20180101' AND '20181231'\n    AND INSTR(SUBSTR(l.cbitmap, 1, 30), '1') > 0\nGROUP BY SUBSTR(f.tdbank_imp_date, 1, 6)\nORDER BY stat_month;",
    "is_valid": true
  },
  {
    "sql_id": "sql_85",
    "sql": "SELECT \n    dtstatdate AS 统计日期,\n    COUNT(DISTINCT a.vplayerid) AS 活跃人数,\n    COUNT(DISTINCT CASE WHEN b.vplayerid IS NOT NULL THEN b.vplayerid END) AS 匹配人数,\n    COUNT(DISTINCT CASE WHEN b.tournamentid > 0 THEN b.vplayerid END) AS 参加微赛事人数,\n    COUNT(DISTINCT CASE WHEN b.tournamentid = 0 OR b.tournamentid IS NULL THEN b.vplayerid END) AS 未参加微赛事人数\nFROM dws_jordass_login_di a\nLEFT JOIN dwd_jordass_player_matchrecord_hi b\n    ON a.vplayerid = b.vplayerid\n    AND a.dtstatdate = SUBSTR(b.tdbank_imp_date, 1, 8)\n    AND b.matchresult = 'ok'\n    AND (\n        (b.tdbank_imp_date BETWEEN '2022050600' AND '2022050823')\n        OR (b.tdbank_imp_date BETWEEN '2022051300' AND '2022051523')\n    )\nWHERE a.platid = 255\n    AND (\n        (a.dtstatdate BETWEEN '20220506' AND '20220508')\n        OR (a.dtstatdate BETWEEN '20220513' AND '20220515')\n    )\nGROUP BY a.dtstatdate\nORDER BY a.dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_87",
    "sql": "SELECT \n    a.dtstatdate AS stat_date,\n    a.matchsubmodegroup AS sub_mode,\n    CASE \n        WHEN DATEDIFF(a.dtstatdate, a.dregdate) <= 6 THEN '新进'\n        WHEN INSTR(SUBSTR(b.cbitmap, 8, 7), '1') > 0 THEN '留存'\n        WHEN INSTR(SUBSTR(b.cbitmap, 8, 7), '1') = 0 THEN '回流'\n    END AS user_type,\n    COUNT(DISTINCT a.vplayerid) AS user_count\nFROM \n    dim_jordass_leyuan_participate_cdf_nf a\nINNER JOIN \n    dws_jordass_login_df b\n    ON a.vplayerid = b.vplayerid \n    AND a.dtstatdate = b.dtstatdate\nWHERE \n    a.dtstatdate IN ('20230702', '20230709')\n    AND b.dtstatdate IN ('20230702', '20230709')\n    AND INSTR(SUBSTR(a.cbitmap, 1, 7), '1') > 0\nGROUP BY \n    a.dtstatdate,\n    a.matchsubmodegroup,\n    CASE \n        WHEN DATEDIFF(a.dtstatdate, a.dregdate) <= 6 THEN '新进'\n        WHEN INSTR(SUBSTR(b.cbitmap, 8, 7), '1') > 0 THEN '留存'\n        WHEN INSTR(SUBSTR(b.cbitmap, 8, 7), '1') = 0 THEN '回流'\n    END\nORDER BY \n    a.dtstatdate,\n    a.matchsubmodegroup,\n    user_type;",
    "is_valid": true
  },
  {
    "sql_id": "sql_88",
    "sql": "WITH user_activity AS (\n    SELECT \n        vplayerid,\n        CONCAT(\n            YEAR(FROM_UNIXTIME(UNIX_TIMESTAMP(dtstatdate, 'yyyyMMdd'))), \n            '-W', \n            LPAD(WEEKOFYEAR(FROM_UNIXTIME(UNIX_TIMESTAMP(dtstatdate, 'yyyyMMdd'))), 2, '0')\n        ) AS week_period,\n        CASE \n            WHEN modename = '传统模式' AND mapname = '群屿' AND submode IN (2557, 2558, 2559) THEN '主题群屿'\n            WHEN modename = '传统模式' AND mapname = '群屿' THEN '群屿'\n            WHEN modename = '传统模式' THEN '传统其他'\n            ELSE modename \n        END AS mode_category,\n        SUM(CASE WHEN dtstatdate BETWEEN '20230529' AND '20230627' THEN 1 ELSE 0 END) AS season_end_days,\n        SUM(CASE WHEN modename = '乐园' AND submode IN (1265972235155284992, 1278160113246405632) THEN 1 ELSE 0 END) AS vertical_mode_days,\n        SUM(CASE WHEN NOT (modename = '乐园' AND submode IN (1265972235155284992, 1278160113246405632)) AND submode IS NOT NULL THEN 1 ELSE 0 END) AS other_mode_days\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20230322' AND '20230627'\n        AND modename IN ('传统模式', '休闲模式', '组队竞技', '领地', '乐园', '广阔天地', '创意创作间')\n    GROUP BY vplayerid, week_period, mode_category\n),\nuser_intensity_calc AS (\n    SELECT \n        vplayerid,\n        week_period,\n        mode_category,\n        CASE \n            WHEN SUM(season_end_days) BETWEEN 1 AND 4 THEN '轻度'\n            WHEN SUM(season_end_days) BETWEEN 5 AND 15 THEN '中度'\n            WHEN SUM(season_end_days) BETWEEN 16 AND 30 THEN '重度'\n            WHEN SUM(vertical_mode_days) > 0 AND SUM(other_mode_days) = 0 THEN '独占'\n            ELSE NULL\n        END AS user_intensity\n    FROM user_activity\n    GROUP BY vplayerid, week_period, mode_category\n)\nSELECT \n    u.week_period,\n    u.user_intensity,\n    u.mode_category,\n    CASE \n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '1' THEN '青铜'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '2' THEN '白银'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '3' THEN '黄金'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '4' THEN '铂金'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '5' THEN '星钻'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '6' THEN '王冠'\n        WHEN SUBSTR(CAST(p.seasonmaxsegment AS STRING), 1, 1) = '7' THEN '王牌'\n        ELSE '未定段位'\n    END AS segment_name,\n    COUNT(DISTINCT u.vplayerid) AS player_count\nFROM user_intensity_calc u\nLEFT JOIN dwd_jordass_playerlogin_hi p ON u.vplayerid = p.vplayerid\nWHERE u.user_intensity IS NOT NULL\nGROUP BY u.week_period, u.user_intensity, u.mode_category, segment_name\nORDER BY u.week_period, u.user_intensity, u.mode_category, segment_name;",
    "is_valid": true
  },
  {
    "sql_id": "sql_89",
    "sql": "WITH vertical_users AS (\n    -- 识别垂类独占用户（赛季末期20230529-20230627）\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT CASE \n            WHEN modename = '乐园' \n            AND submode IN (1265972235155284992, 1278160113246405632) \n            THEN dtstatdate \n        END) AS vertical_active_days,\n        COUNT(DISTINCT CASE \n            WHEN NOT (modename = '乐园' AND submode IN (1265972235155284992, 1278160113246405632))\n            AND modename IS NOT NULL\n            THEN dtstatdate \n        END) AS other_mode_days\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20230529' AND '20230627'\n    GROUP BY vplayerid\n    HAVING vertical_active_days > 0 AND other_mode_days = 0\n),\nuser_activity_level AS (\n    -- 为垂类独占用户分配活跃度等级\n    SELECT \n        vplayerid,\n        CASE \n            WHEN vertical_active_days BETWEEN 1 AND 4 THEN '轻度'\n            WHEN vertical_active_days BETWEEN 5 AND 15 THEN '中度'\n            WHEN vertical_active_days BETWEEN 16 AND 30 THEN '重度'\n        END AS activity_level\n    FROM vertical_users\n),\nweekly_stats AS (\n    -- 计算每周的登录天数和垂类玩法参与情况\n    SELECT \n        u.vplayerid,\n        u.activity_level,\n        CONCAT(YEAR(date_format(l.dtstatdate, '%Y-%m-%d')), '-W', WEEKOFYEAR(date_format(l.dtstatdate, '%Y-%m-%d'))) AS week_period,\n        COUNT(DISTINCT l.dtstatdate) AS login_days,\n        COUNT(DISTINCT m.dtstatdate) AS mode_play_days,\n        COALESCE(SUM(m.roundcnt), 0) AS mode_round_count\n    FROM user_activity_level u\n    LEFT JOIN dws_jordass_login_di l \n        ON u.vplayerid = l.vplayerid \n        AND l.dtstatdate BETWEEN '20230322' AND '20230627'\n        AND l.platid = 255\n    LEFT JOIN dws_jordass_mode_roundrecord_di m \n        ON u.vplayerid = m.vplayerid \n        AND m.dtstatdate BETWEEN '20230322' AND '20230627'\n        AND m.modename = '乐园'\n        AND m.submode IN (1265972235155284992, 1278160113246405632)\n    GROUP BY u.vplayerid, u.activity_level, week_period\n)\n-- 最终输出：按周期、活跃度、登录天数分组统计\nSELECT \n    week_period AS 周期,\n    activity_level AS 活跃度,\n    login_days AS 活跃天数,\n    COUNT(DISTINCT vplayerid) AS 人数,\n    SUM(mode_play_days) AS 垂类玩法参与天数,\n    SUM(mode_round_count) AS 垂类玩法参与局数\nFROM weekly_stats\nWHERE activity_level IS NOT NULL\nGROUP BY week_period, activity_level, login_days\nORDER BY week_period, activity_level, login_days;",
    "is_valid": true
  },
  {
    "sql_id": "sql_90",
    "sql": "WITH base_users AS (\n    -- 获取截至2023.6.30的活跃用户，且在7.01-7.16未活跃的用户\n    SELECT \n        vplayerid,\n        cbitmap,\n        CASE \n            -- 7天内活跃（第2-8位有1）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 7), '1') > 0 THEN '7天内活跃'\n            -- 14天内未活跃（第2-15位全0）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 14), '1') = 0 THEN '14天内未活跃'\n            -- 30天内未活跃（第2-31位全0）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 30), '1') = 0 THEN '30天内未活跃'\n            -- 60天内未活跃（第2-61位全0）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 60), '1') = 0 THEN '60天内未活跃'\n            -- 90天内未活跃（第2-91位全0）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 90), '1') = 0 THEN '90天内未活跃'\n            -- 180天内未活跃（bitmap只有100位，第2-100位全0）\n            WHEN INSTR(SUBSTR(cbitmap, 2, 99), '1') = 0 THEN '180天内未活跃'\n            -- 360天内未活跃（同180天，因为bitmap限制）\n            ELSE '360天内未活跃'\n        END AS active_segment\n    FROM dws_jordass_login_df\n    WHERE dtstatdate = '20230630'\n        AND platid = 255\n        AND INSTR(SUBSTR(cbitmap, 2, 16), '1') = 0  -- 7.01-7.16未活跃（第2-17位全0）\n),\nbridge_players AS (\n    -- 获取7.17-7.23玩桥梁争夺的用户\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_player_matchrecord_hi\n    WHERE tdbank_imp_date BETWEEN '2023071700' AND '2023072323'\n        AND matchsubmodegroup = 1310822585431254784\n)\nSELECT \n    b.active_segment AS 活跃分层,\n    COUNT(DISTINCT p.vplayerid) AS 玩桥梁争夺人数\nFROM base_users b\nINNER JOIN bridge_players p ON b.vplayerid = p.vplayerid\nGROUP BY b.active_segment\nORDER BY \n    CASE b.active_segment\n        WHEN '360天内未活跃' THEN 1\n        WHEN '180天内未活跃' THEN 2\n        WHEN '90天内未活跃' THEN 3\n        WHEN '60天内未活跃' THEN 4\n        WHEN '30天内未活跃' THEN 5\n        WHEN '14天内未活跃' THEN 6\n        WHEN '7天内未活跃' THEN 7\n        WHEN '7天内活跃' THEN 8\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_91",
    "sql": "WITH base_data AS (\n    SELECT \n        dtstatdate,\n        vplayerid,\n        dregdate,\n        cbitmap\n    FROM dws_jordass_login_df\n    WHERE dtstatdate IN ('20230718', '20230725')\n        AND platid = 255\n        AND substr(cbitmap, 1, 1) = '1'\n),\nclassified_users AS (\n    SELECT \n        dtstatdate,\n        vplayerid,\n        CASE \n            WHEN dregdate = dtstatdate THEN '新进'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 2, 6), '1') > 0 THEN '7'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 8, 7), '1') > 0 THEN '14'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 15, 16), '1') > 0 THEN '30'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 31, 30), '1') > 0 THEN '60'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 61, 30), '1') > 0 THEN '90'\n            WHEN dregdate < dtstatdate AND instr(substr(cbitmap, 91, 90), '1') > 0 THEN '180'\n            ELSE NULL\n        END AS retention_type\n    FROM base_data\n)\nSELECT \n    dtstatdate AS `统计日期`,\n    retention_type AS `类型`,\n    COUNT(DISTINCT vplayerid) AS `人数`\nFROM classified_users\nWHERE retention_type IS NOT NULL\nGROUP BY dtstatdate, retention_type\nORDER BY dtstatdate, \n    CASE retention_type\n        WHEN '新进' THEN 1\n        WHEN '7' THEN 2\n        WHEN '14' THEN 3\n        WHEN '30' THEN 4\n        WHEN '60' THEN 5\n        WHEN '90' THEN 6\n        WHEN '180' THEN 7\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_92",
    "sql": "SELECT \n    t1.return_type AS 回流类型,\n    CASE \n        WHEN t2.login_days BETWEEN 1 AND 2 THEN '轻度'\n        WHEN t2.login_days BETWEEN 3 AND 5 THEN '中度'\n        WHEN t2.login_days BETWEEN 6 AND 7 THEN '重度'\n        ELSE '流失'\n    END AS 活跃情况,\n    COUNT(DISTINCT t1.vplayerid) AS 人数\nFROM (\n    -- 识别上周回流用户\n    SELECT \n        vplayerid,\n        CASE \n            WHEN substr(cbitmap, 1, 7) = '0000000' \n                 AND instr(substr(cbitmap, 8, 30), '1') > 0 THEN '7天回流'\n            WHEN substr(cbitmap, 1, 30) = '000000000000000000000000000000' \n                 AND instr(substr(cbitmap, 31, 70), '1') > 0 THEN '30天回流'\n        END AS return_type\n    FROM dws_jordass_login_df\n    WHERE dtstatdate = '20230711'\n        AND platid = 255\n        AND (\n            (substr(cbitmap, 1, 7) = '0000000' AND instr(substr(cbitmap, 8, 30), '1') > 0)\n            OR (substr(cbitmap, 1, 30) = '000000000000000000000000000000' AND instr(substr(cbitmap, 31, 70), '1') > 0)\n        )\n) t1\nLEFT JOIN (\n    -- 统计本周活跃天数\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS login_days\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20230712' AND '20230718'\n        AND platid = 255\n    GROUP BY vplayerid\n) t2 ON t1.vplayerid = t2.vplayerid\nGROUP BY t1.return_type, \n    CASE \n        WHEN t2.login_days BETWEEN 1 AND 2 THEN '轻度'\n        WHEN t2.login_days BETWEEN 3 AND 5 THEN '中度'\n        WHEN t2.login_days BETWEEN 6 AND 7 THEN '重度'\n        ELSE '流失'\n    END\nORDER BY t1.return_type, \n    CASE \n        WHEN t2.login_days BETWEEN 1 AND 2 THEN '轻度'\n        WHEN t2.login_days BETWEEN 3 AND 5 THEN '中度'\n        WHEN t2.login_days BETWEEN 6 AND 7 THEN '重度'\n        ELSE '流失'\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_93",
    "sql": "SELECT \n    SUBSTR(`dtstatdate`, 1, 6) AS month,\n    CASE \n        WHEN `dwaterdate` >= CONCAT(SUBSTR(`dtstatdate`, 1, 6), '01') \n             AND `dwaterdate` <= `dtstatdate` THEN 1\n        WHEN INSTR(SUBSTR(`cbitmap`, 1, 30), '1') > 0 THEN 2\n        WHEN INSTR(SUBSTR(`cbitmap`, 1, 30), '1') = 0 \n             AND INSTR(SUBSTR(`cbitmap`, 31, 70), '1') > 0 THEN 3\n    END AS pay_type,\n    COUNT(DISTINCT `vplayerid`) AS user_count,\n    ROUND(SUM(`imoney`) / 100, 2) AS pay_amount_yuan\nFROM \n    dws_jordass_water_df\nWHERE \n    `dtstatdate` BETWEEN '20240101' AND '20240531'\n    AND `platid` = 255\n    AND (\n        (`dwaterdate` >= CONCAT(SUBSTR(`dtstatdate`, 1, 6), '01') AND `dwaterdate` <= `dtstatdate`)\n        OR INSTR(SUBSTR(`cbitmap`, 1, 30), '1') > 0\n        OR (INSTR(SUBSTR(`cbitmap`, 1, 30), '1') = 0 AND INSTR(SUBSTR(`cbitmap`, 31, 70), '1') > 0)\n    )\nGROUP BY \n    SUBSTR(`dtstatdate`, 1, 6),\n    CASE \n        WHEN `dwaterdate` >= CONCAT(SUBSTR(`dtstatdate`, 1, 6), '01') \n             AND `dwaterdate` <= `dtstatdate` THEN 1\n        WHEN INSTR(SUBSTR(`cbitmap`, 1, 30), '1') > 0 THEN 2\n        WHEN INSTR(SUBSTR(`cbitmap`, 1, 30), '1') = 0 \n             AND INSTR(SUBSTR(`cbitmap`, 31, 70), '1') > 0 THEN 3\n    END\nORDER BY \n    month, pay_type;",
    "is_valid": true
  },
  {
    "sql_id": "sql_94",
    "sql": "SELECT \n    a.dtstatdate AS 统计日期,\n    CASE \n        WHEN a.device_type IN (1, 5) THEN '模拟器'\n        WHEN a.device_type = 0 THEN '手机'\n        ELSE '其他'\n    END AS 设备类型,\n    SUBSTR(c.dregdate, 1, 4) AS 注册年份,\n    COUNT(DISTINCT a.vplayerid) AS 使用设备的人数,\n    COUNT(DISTINCT b.vplayerid) AS 使用设备玩生存模式人数,\n    ROUND(COUNT(DISTINCT b.vplayerid) * 1.0 / NULLIF(COUNT(DISTINCT a.vplayerid), 0), 4) AS 使用设备玩生存模式占总设备人数的比例,\n    ROUND(SUM(CASE WHEN SUBSTR(c.cbitmap, 2, 1) = '1' THEN 1 ELSE 0 END) * 1.0 / NULLIF(COUNT(DISTINCT b.vplayerid), 0), 4) AS 使用设备玩生存模式的次留率\nFROM \n    dws_jordass_device_login_di a\nLEFT JOIN \n    dws_jordass_mode_roundrecord_di b\n    ON a.vplayerid = b.vplayerid\n    AND a.vgameappid = b.vgameappid\n    AND a.dtstatdate = b.dtstatdate\n    AND a.device_type = b.device_type\n    AND b.modename = '生存模式'\n    AND b.dtstatdate BETWEEN '20241123' AND '20241128'\nINNER JOIN \n    dws_jordass_login_df c\n    ON a.vplayerid = c.vplayerid\n    AND a.vgameappid = c.vgameappid\n    AND c.dtstatdate = '20241128'\nWHERE \n    a.dtstatdate BETWEEN '20241123' AND '20241128'\nGROUP BY \n    a.dtstatdate,\n    a.device_type,\n    SUBSTR(c.dregdate, 1, 4)\nORDER BY \n    a.dtstatdate,\n    设备类型,\n    注册年份;",
    "is_valid": true
  },
  {
    "sql_id": "sql_97",
    "sql": "SELECT \n    COUNT(DISTINCT t1.vplayerid) AS hidden_users,\n    COUNT(DISTINCT CASE \n        WHEN EXISTS(\n            SELECT 1 \n            FROM dws_jordass_matchlog_stat_di t2 \n            WHERE t2.vplayerid = t1.vplayerid \n                AND t2.imode = 1310822585431254784 \n                AND t2.platid <> 255 \n                AND t2.dtstatdate BETWEEN '20230719' AND '20230725'\n        ) THEN t1.vplayerid \n    END) AS hidden_and_bridge_users,\n    COUNT(DISTINCT CASE \n        WHEN EXISTS(\n            SELECT 1 \n            FROM dws_jordass_mode_roundrecord_di t3 \n            WHERE t3.vplayerid = t1.vplayerid \n                AND t3.mode = 2370 \n                AND t3.dtstatdate BETWEEN '20230719' AND '20230725'\n        ) THEN t1.vplayerid \n    END) AS hidden_and_stealth_mode_users\nFROM dws_jordass_matchlog_stat_di t1\nWHERE t1.dtstatdate BETWEEN '20230719' AND '20230725'\n    AND t1.imode = 1307095884553538304\n    AND t1.platid <> 255",
    "is_valid": true
  },
  {
    "sql_id": "sql_98",
    "sql": "SELECT \n    dtstatdate,\n    user_type,\n    user_count,\n    login_count\nFROM (\n    -- 乐园高活跃用户\n    SELECT \n        a.dtstatdate,\n        '乐园高活' AS user_type,\n        COUNT(DISTINCT a.vplayerid) AS user_count,\n        COUNT(DISTINCT CASE WHEN b.ilogincount > 0 THEN a.vplayerid END) AS login_count\n    FROM \n        dws_jordass_buttonpress_pre_di a\n    LEFT JOIN \n        dws_jordass_login_di b\n        ON a.vplayerid = b.vplayerid \n        AND a.dtstatdate = b.dtstatdate\n        AND b.platid = 255\n        AND b.dtstatdate BETWEEN '20240527' AND '20240616'\n    WHERE \n        a.dtstatdate BETWEEN '20240527' AND '20240616'\n    GROUP BY \n        a.dtstatdate\n    \n    UNION ALL\n    \n    -- 砺刃高活跃用户\n    SELECT \n        dtstatdate,\n        '砺刃高活' AS user_type,\n        COUNT(DISTINCT vplayerid) AS user_count,\n        COUNT(DISTINCT CASE WHEN ilogincount > 0 THEN vplayerid END) AS login_count\n    FROM \n        dws_jordass_login_di\n    WHERE \n        dtstatdate BETWEEN '20240527' AND '20240616'\n        AND platid = 255\n    GROUP BY \n        dtstatdate\n) t\nORDER BY \n    dtstatdate, \n    user_type;",
    "is_valid": true
  },
  {
    "sql_id": "sql_99",
    "sql": "SELECT\n    submode AS 子玩法,\n    pay_category AS 分类,\n    pay_tier AS 付费分层,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM (\n    SELECT\n        vplayerid,\n        submode,\n        CASE \n            WHEN submode IS NULL OR submode = '' THEN '砺刃' \n            ELSE '乐园' \n        END AS pay_category,\n        SUM(amount / 10) AS pay_amount,\n        CASE \n            WHEN SUM(amount / 10) >= 1 AND SUM(amount / 10) < 30 THEN '小R'\n            WHEN SUM(amount / 10) >= 30 AND SUM(amount / 10) < 100 THEN '中小R'\n            WHEN SUM(amount / 10) >= 100 AND SUM(amount / 10) < 500 THEN '中R'\n            WHEN SUM(amount / 10) >= 500 AND SUM(amount / 10) < 1500 THEN '大R'\n            WHEN SUM(amount / 10) >= 1500 THEN '超R'\n            ELSE '未付费'\n        END AS pay_tier\n    FROM dwd_jordass_payrespond_hi\n    WHERE dteventtime BETWEEN '2024-06-01 00:00:00' AND '2024-06-30 23:59:59'\n        AND res = 'ok'\n        AND (submode IS NOT NULL AND submode != '')\n    GROUP BY vplayerid, submode\n) t\nGROUP BY submode, pay_category, pay_tier\nORDER BY 子玩法, \n    CASE pay_tier\n        WHEN '小R' THEN 1\n        WHEN '中小R' THEN 2\n        WHEN '中R' THEN 3\n        WHEN '大R' THEN 4\n        WHEN '超R' THEN 5\n        ELSE 6\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_100",
    "sql": "WITH business_data AS (\n  -- 手册\n  SELECT \n    '手册' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(CASE WHEN imoneytype = 1 THEN 1 ELSE 0 END) * 1.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_currencylog_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n    AND reason IN (143, 144, 156, 158, 246, 269, 273)\n    AND addorreduce = 1\n    AND imoneytype = 1\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 元素\n  SELECT \n    '元素' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(CASE WHEN imoneytype = 1027 THEN 1 ELSE 0 END) * 1.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_currencylog_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n    AND reason IN (189, 190)\n    AND addorreduce = 1\n    AND imoneytype = 1027\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 轮盘\n  SELECT \n    '轮盘' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(costnum) * 10.0 AS money,\n    SUM(lotteryround) AS icnt\n  FROM dwd_jordass_lotteryrecord_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 限定抽取\n  SELECT \n    '限定抽取' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(costnum) * 10.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_lotterylog_twostage_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 专属卡\n  SELECT \n    '专属卡' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(moneycnt) * 10.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_privpackagelog_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 战备\n  SELECT \n    '战备' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(1) * 1.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_marketpurchase_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n    AND itemid_1 IN (1515013, 1515020, 1515023, 1515060, 1515277, 1515279)\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n  \n  UNION ALL\n  \n  -- 直购\n  SELECT \n    '直购' AS itype,\n    SUBSTR(tdbank_imp_date, 1, 8) AS dt,\n    vplayerid,\n    SUM(1) * 1.0 AS money,\n    COUNT(*) AS icnt\n  FROM dwd_jordass_marketpurchase_hi\n  WHERE tdbank_imp_date BETWEEN '2024032600' AND '2024052723'\n    AND itemid_1 NOT IN (1515013, 1515020, 1515023, 1515060, 1515277, 1515279, 1515029, 1515120, 1515123, 1515122, 1515121)\n  GROUP BY SUBSTR(tdbank_imp_date, 1, 8), vplayerid\n)\n\nSELECT \n  b.dt AS `日期`,\n  CASE \n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 7), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 8, 23), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') > 0 THEN '7日回流'\n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 30), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 61, 30), '1') > 0 THEN '30日回流'\n    WHEN l.dregdate BETWEEN '20240326' AND '20240527' THEN '新进玩家'\n  END AS `玩家类型`,\n  COUNT(DISTINCT l.vplayerid) AS `总人数`,\n  SUM(b.money) AS `总付费`,\n  COUNT(DISTINCT b.vplayerid) AS `总付费人数`,\n  b.itype AS `商业化类型`,\n  COUNT(DISTINCT b.vplayerid) AS `消耗人数`,\n  SUM(b.icnt) AS `抽奖次数_购买次数`,\n  SUM(b.money) AS `付费数`\nFROM business_data b\nINNER JOIN dws_jordass_login_df l\n  ON b.vplayerid = l.vplayerid\n  AND l.dtstatdate = '20240527'\n  AND l.platid = 255\nWHERE CASE \n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 7), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 8, 23), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') > 0 THEN '7日回流'\n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 30), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 61, 30), '1') > 0 THEN '30日回流'\n    WHEN l.dregdate BETWEEN '20240326' AND '20240527' THEN '新进玩家'\n  END IS NOT NULL\nGROUP BY \n  b.dt,\n  CASE \n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 7), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 8, 23), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') > 0 THEN '7日回流'\n    WHEN INSTR(SUBSTR(l.cbitmap, 1, 30), '1') > 0 \n      AND INSTR(SUBSTR(l.cbitmap, 31, 30), '1') = 0 \n      AND INSTR(SUBSTR(l.cbitmap, 61, 30), '1') > 0 THEN '30日回流'\n    WHEN l.dregdate BETWEEN '20240326' AND '20240527' THEN '新进玩家'\n  END,\n  b.itype\nORDER BY b.dt, `玩家类型`, b.itype;",
    "is_valid": true
  },
  {
    "sql_id": "sql_101",
    "sql": "SELECT \n    login.dtstatdate AS 统计日,\n    CASE \n        WHEN substr(player.seasonmaxsegment, 1, 1) = '1' THEN '青铜'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '2' THEN '白银'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '3' THEN '黄金'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '4' THEN '铂金'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '5' THEN '星钻'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '6' THEN '王冠'\n        WHEN substr(player.seasonmaxsegment, 1, 1) >= '7' THEN '王牌'\n        ELSE '无段位'\n    END AS 本赛季最高段位,\n    COUNT(DISTINCT login.vplayerid) AS 活跃用户数,\n    COUNT(DISTINCT mode.vplayerid) AS 统计日参与主题群屿玩法用户数,\n    ROUND(COUNT(DISTINCT mode.vplayerid) * 1.0 / COUNT(DISTINCT login.vplayerid), 4) AS 参与率\nFROM \n    dws_jordass_login_di AS login\nLEFT JOIN \n    dwd_jordass_playerlogin_hi AS player\n    ON login.vplayerid = player.vplayerid\n    AND login.dtstatdate = substr(player.tdbank_imp_date, 1, 8)\nLEFT JOIN \n    dws_jordass_mode_roundrecord_di AS mode\n    ON login.vplayerid = mode.vplayerid\n    AND login.dtstatdate = mode.dtstatdate\n    AND mode.modename = '传统模式'\n    AND mode.submodename LIKE 'CG%'\nWHERE \n    login.dtstatdate IN ('20240902', '20240903', '20250908', '20250909')\n    AND login.platid = 255\nGROUP BY \n    login.dtstatdate,\n    CASE \n        WHEN substr(player.seasonmaxsegment, 1, 1) = '1' THEN '青铜'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '2' THEN '白银'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '3' THEN '黄金'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '4' THEN '铂金'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '5' THEN '星钻'\n        WHEN substr(player.seasonmaxsegment, 1, 1) = '6' THEN '王冠'\n        WHEN substr(player.seasonmaxsegment, 1, 1) >= '7' THEN '王牌'\n        ELSE '无段位'\n    END\nORDER BY \n    login.dtstatdate,\n    本赛季最高段位;",
    "is_valid": true
  },
  {
    "sql_id": "sql_103",
    "sql": "SELECT \n    a.tdbank_imp_date AS stat_date,\n    a.productid,\n    COUNT(DISTINCT a.vplayerid) AS buy_users,\n    SUM(a.money) AS buy_amount,\n    SUM(a.goodsnum) AS buy_quantity,\n    COUNT(DISTINCT CASE \n        WHEN b.dregdate = a.tdbank_imp_date THEN a.vplayerid \n        END) AS new_reg_users\nFROM \n    dwd_jordass_directpaycommflow_hi a\nLEFT JOIN \n    dws_jordass_login_df b\n    ON a.vplayerid = b.vplayerid \n    AND a.vgameappid = b.vgameappid\n    AND b.dtstatdate = '20250910'\nWHERE \n    a.tdbank_imp_date BETWEEN '20250901' AND '20250910'\n    AND a.op = 'take'\n    AND a.opres = 'ok'\n    AND a.productid IN ('package_6', 'package_18', 'outfit_pack', 'weapon_pack')\nGROUP BY \n    a.tdbank_imp_date,\n    a.productid\nORDER BY \n    a.tdbank_imp_date,\n    a.productid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_105",
    "sql": "WITH charge_data AS (\n    SELECT \n        dtstatdate AS stat_date,\n        SUM(imoney) AS recharge_amount\n    FROM dws_jordass_water_di\n    WHERE dtstatdate BETWEEN '20240101' AND '20250601'\n    GROUP BY dtstatdate\n),\nconsume_data AS (\n    SELECT \n        SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n        SUM(imoney) AS consume_coin\n    FROM dwd_jordass_currencylog_hi\n    WHERE tdbank_imp_date BETWEEN '2024010100' AND '2025060123'\n        AND addorreduce = 1\n        AND imoneytype = 1\n    GROUP BY SUBSTR(tdbank_imp_date, 1, 8)\n)\nSELECT \n    COALESCE(a.stat_date, b.stat_date) AS stat_date,\n    COALESCE(a.recharge_amount, 0) AS recharge_amount,\n    COALESCE(b.consume_coin, 0) AS consume_coin\nFROM charge_data a\nFULL OUTER JOIN consume_data b ON a.stat_date = b.stat_date\nORDER BY stat_date;",
    "is_valid": true
  },
  {
    "sql_id": "sql_107",
    "sql": "WITH \n-- 第一个时间段：2022.1.18-1.24\nperiod1 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_activitypress_hi\n    WHERE substr(dteventtime, 1, 10) BETWEEN '2022-01-18' AND '2022-01-24'\n      AND buttontype = 99123\n      AND ireason = 3\n),\n-- 第二个时间段：2021.10.19-12.20\nperiod2 AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_activitypress_hi\n    WHERE substr(dteventtime, 1, 10) BETWEEN '2021-10-19' AND '2021-12-20'\n      AND buttontype = 99123\n      AND ireason = 3\n),\n-- 交叉用户\ncross_users AS (\n    SELECT p1.vplayerid\n    FROM period1 p1\n    INNER JOIN period2 p2 ON p1.vplayerid = p2.vplayerid\n)\n\nSELECT \n    (SELECT COUNT(*) FROM period1) AS period1_users,\n    (SELECT COUNT(*) FROM period2) AS period2_users,\n    (SELECT COUNT(*) FROM cross_users) AS cross_users",
    "is_valid": true
  },
  {
    "sql_id": "sql_108",
    "sql": "SELECT \n    CASE \n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 7), '1') = 0 \n             AND INSTR(SUBSTR(a.cbitmap, 8, 7), '1') > 0 \n        THEN 'iweek'\n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 14), '1') = 0 \n             AND INSTR(SUBSTR(a.cbitmap, 15, 14), '1') > 0 \n        THEN 'doubleiweek'\n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 30), '1') = 0 \n             AND INSTR(SUBSTR(a.cbitmap, 31, 30), '1') > 0 \n        THEN 'imonth'\n        WHEN LENGTH(REPLACE(SUBSTR(a.cbitmap, 1, 30), '0', '')) < 3 \n             AND LENGTH(REPLACE(SUBSTR(a.cbitmap, 1, 30), '0', '')) > 0 \n        THEN '30dayxioayu3day'\n    END AS type,\n    b.iqq\nFROM \n    dws_jordass_login_df a\nINNER JOIN \n    dim_mgamejp_tbplayerid2qq_nf b\n    ON a.vplayerid = b.splayerid \n    AND b.sappid = 'jordass'\nWHERE \n    a.dtstatdate = '20250424'\n    AND a.platid = 255\n    AND (\n        (INSTR(SUBSTR(a.cbitmap, 1, 7), '1') = 0 \n         AND INSTR(SUBSTR(a.cbitmap, 8, 7), '1') > 0)\n        OR \n        (INSTR(SUBSTR(a.cbitmap, 1, 14), '1') = 0 \n         AND INSTR(SUBSTR(a.cbitmap, 15, 14), '1') > 0)\n        OR \n        (INSTR(SUBSTR(a.cbitmap, 1, 30), '1') = 0 \n         AND INSTR(SUBSTR(a.cbitmap, 31, 30), '1') > 0)\n        OR \n        (LENGTH(REPLACE(SUBSTR(a.cbitmap, 1, 30), '0', '')) < 3 \n         AND LENGTH(REPLACE(SUBSTR(a.cbitmap, 1, 30), '0', '')) > 0)\n    );",
    "is_valid": true
  },
  {
    "sql_id": "sql_109",
    "sql": "WITH win_records AS (\n    -- 传统模式胜利记录\n    SELECT \n        uid,\n        COUNT(*) AS win_count\n    FROM dwd_jordass_roundflow_hi\n    WHERE dteventtime >= '2025-04-24 00:00:00'\n      AND dteventtime < '2025-05-09 00:00:00'\n      AND mode IN (101, 102, 103, 401, 402, 403)\n      AND teamrank = 1\n    GROUP BY uid\n    \n    UNION ALL\n    \n    -- 休闲模式胜利记录\n    SELECT \n        uid,\n        COUNT(*) AS win_count\n    FROM dwd_jordass_roundlog_funnymode_hi\n    WHERE dteventtime >= '2025-04-24 00:00:00'\n      AND dteventtime < '2025-05-09 00:00:00'\n      AND mode IN (201, 202, 203, 601, 602, 603)\n      AND teamrank = 1\n    GROUP BY uid\n),\nuser_total_wins AS (\n    -- 汇总每个用户的总胜利数\n    SELECT \n        uid,\n        SUM(win_count) AS total_wins\n    FROM win_records\n    GROUP BY uid\n)\nSELECT \n    CASE \n        WHEN total_wins = 1 THEN '1'\n        WHEN total_wins BETWEEN 2 AND 10 THEN '2-10'\n        WHEN total_wins BETWEEN 11 AND 20 THEN '11-20'\n        WHEN total_wins BETWEEN 21 AND 50 THEN '21-50'\n        WHEN total_wins BETWEEN 51 AND 80 THEN '51-80'\n        WHEN total_wins BETWEEN 81 AND 100 THEN '81-100'\n        WHEN total_wins BETWEEN 101 AND 200 THEN '101-200'\n        WHEN total_wins BETWEEN 201 AND 500 THEN '201-500'\n        WHEN total_wins >= 501 THEN '501以上'\n    END AS win_distribution,\n    COUNT(DISTINCT uid) AS player_count\nFROM user_total_wins\nGROUP BY \n    CASE \n        WHEN total_wins = 1 THEN '1'\n        WHEN total_wins BETWEEN 2 AND 10 THEN '2-10'\n        WHEN total_wins BETWEEN 11 AND 20 THEN '11-20'\n        WHEN total_wins BETWEEN 21 AND 50 THEN '21-50'\n        WHEN total_wins BETWEEN 51 AND 80 THEN '51-80'\n        WHEN total_wins BETWEEN 81 AND 100 THEN '81-100'\n        WHEN total_wins BETWEEN 101 AND 200 THEN '101-200'\n        WHEN total_wins BETWEEN 201 AND 500 THEN '201-500'\n        WHEN total_wins >= 501 THEN '501以上'\n    END\nORDER BY \n    CASE win_distribution\n        WHEN '1' THEN 1\n        WHEN '2-10' THEN 2\n        WHEN '11-20' THEN 3\n        WHEN '21-50' THEN 4\n        WHEN '51-80' THEN 5\n        WHEN '81-100' THEN 6\n        WHEN '101-200' THEN 7\n        WHEN '201-500' THEN 8\n        WHEN '501以上' THEN 9\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_110",
    "sql": "SELECT \n    t0.dtstatdate AS stat_date,\n    COUNT(DISTINCT t0.vplayerid) AS active_users,\n    COUNT(DISTINCT t1.vplayerid) AS login_day2_retention,\n    COUNT(DISTINCT t2.vplayerid) AS login_day3_retention,\n    COUNT(DISTINCT t6.vplayerid) AS login_day7_retention,\n    COUNT(DISTINCT CASE WHEN a0.vplayerid IS NOT NULL THEN t1.vplayerid END) AS activity_day2_retention,\n    COUNT(DISTINCT CASE WHEN a0.vplayerid IS NOT NULL THEN t2.vplayerid END) AS activity_day3_retention,\n    COUNT(DISTINCT CASE WHEN a0.vplayerid IS NOT NULL THEN t6.vplayerid END) AS activity_day7_retention\nFROM \n    dws_jordass_login_di t0\nLEFT JOIN dws_jordass_login_di t1 \n    ON t0.vplayerid = t1.vplayerid \n    AND t1.dtstatdate = DATE_FORMAT(DATE_ADD(STR_TO_DATE(t0.dtstatdate, '%Y%m%d'), INTERVAL 1 DAY), '%Y%m%d')\n    AND t1.platid = 255\nLEFT JOIN dws_jordass_login_di t2 \n    ON t0.vplayerid = t2.vplayerid \n    AND t2.dtstatdate = DATE_FORMAT(DATE_ADD(STR_TO_DATE(t0.dtstatdate, '%Y%m%d'), INTERVAL 2 DAY), '%Y%m%d')\n    AND t2.platid = 255\nLEFT JOIN dws_jordass_login_di t6 \n    ON t0.vplayerid = t6.vplayerid \n    AND t6.dtstatdate = DATE_FORMAT(DATE_ADD(STR_TO_DATE(t0.dtstatdate, '%Y%m%d'), INTERVAL 6 DAY), '%Y%m%d')\n    AND t6.platid = 255\nLEFT JOIN (\n    SELECT DISTINCT \n        vplayerid,\n        SUBSTR(tdbank_imp_date, 1, 8) AS activity_date\n    FROM dwd_jordass_activity_rewardrecord_hi\n    WHERE tdbank_imp_date BETWEEN '2022041300' AND '2022042123'\n        AND actid = 2201123904\n) a0 \n    ON t0.vplayerid = a0.vplayerid \n    AND t0.dtstatdate = a0.activity_date\nWHERE \n    t0.dtstatdate BETWEEN '20220413' AND '20220421'\n    AND t0.platid = 255\nGROUP BY \n    t0.dtstatdate\nORDER BY \n    t0.dtstatdate;",
    "is_valid": true
  },
  {
    "sql_id": "sql_111",
    "sql": "SELECT \n    tdbank_imp_date AS stat_date,\n    type_name,\n    x,\n    y,\n    z,\n    COUNT(1) AS cnt\nFROM (\n    -- 变身速行战士\n    SELECT \n        tdbank_imp_date,\n        '变身速行战士' AS type_name,\n        ROUND(CAST(split(SwiftMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(SwiftMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(SwiftMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND SwiftMorphInfo IS NOT NULL \n      AND SwiftMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身隐形战士\n    SELECT \n        tdbank_imp_date,\n        '变身隐形战士' AS type_name,\n        ROUND(CAST(split(StealthMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(StealthMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(StealthMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND StealthMorphInfo IS NOT NULL \n      AND StealthMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身钩链战士\n    SELECT \n        tdbank_imp_date,\n        '变身钩链战士' AS type_name,\n        ROUND(CAST(split(GrappleMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(GrappleMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(GrappleMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND GrappleMorphInfo IS NOT NULL \n      AND GrappleMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身强能猎手\n    SELECT \n        tdbank_imp_date,\n        '变身强能猎手' AS type_name,\n        ROUND(CAST(split(HeroMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(HeroMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(HeroMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND HeroMorphInfo IS NOT NULL \n      AND HeroMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身冰霜领主\n    SELECT \n        tdbank_imp_date,\n        '变身冰霜领主' AS type_name,\n        ROUND(CAST(split(IceAdvMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(IceAdvMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(IceAdvMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND IceAdvMorphInfo IS NOT NULL \n      AND IceAdvMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身强化战士\n    SELECT \n        tdbank_imp_date,\n        '变身强化战士' AS type_name,\n        ROUND(CAST(split(PowerAdvMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(PowerAdvMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(PowerAdvMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND PowerAdvMorphInfo IS NOT NULL \n      AND PowerAdvMorphInfo != ''\n    \n    UNION ALL\n    \n    -- 变身龙焰猎手\n    SELECT \n        tdbank_imp_date,\n        '变身龙焰猎手' AS type_name,\n        ROUND(CAST(split(DragonHeroMorphInfo, ',')[3] AS DOUBLE), 1) AS x,\n        ROUND(CAST(split(DragonHeroMorphInfo, ',')[4] AS DOUBLE), 1) AS y,\n        ROUND(CAST(split(DragonHeroMorphInfo, ',')[5] AS DOUBLE), 1) AS z\n    FROM dwd_jordass_vsteaminfectlog_hi\n    WHERE tdbank_imp_date = '20220425'\n      AND DragonHeroMorphInfo IS NOT NULL \n      AND DragonHeroMorphInfo != ''\n) t\nGROUP BY \n    tdbank_imp_date,\n    type_name,\n    x,\n    y,\n    z\nORDER BY \n    stat_date,\n    type_name,\n    cnt DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_112",
    "sql": "SELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT vplayerid) AS player_count\nFROM \n    dwd_jordass_roundflow_hi\nWHERE \n    tdbank_imp_date BETWEEN '2022042300' AND '2022043023'\n    AND mode IN (101, 102, 103, 401, 402, 403)\n    AND survivaltime >= 5400\nGROUP BY \n    SUBSTR(tdbank_imp_date, 1, 8)\n\nUNION ALL\n\nSELECT \n    SUBSTR(tdbank_imp_date, 1, 8) AS stat_date,\n    COUNT(DISTINCT vplayerid) AS player_count\nFROM \n    dwd_jordass_roundflow_hi\nWHERE \n    tdbank_imp_date BETWEEN '2022050100' AND '2022050823'\n    AND mode IN (101, 102, 103, 401, 402, 403)\n    AND survivaltime >= 5400\nGROUP BY \n    SUBSTR(tdbank_imp_date, 1, 8)\n\nORDER BY \n    stat_date;",
    "is_valid": true
  },
  {
    "sql_id": "sql_113",
    "sql": "SELECT \n    DATE_FORMAT(`dteventtime`, '%Y%m%d') AS stat_date,\n    `shopid`,\n    COUNT(DISTINCT `vplayerid`) AS user_count,\n    COUNT(1) AS purchase_count\nFROM \n    dwd_jordass_vsteamshoplog_hi\nWHERE \n    `dteventtime` BETWEEN '2022-04-25' AND '2022-05-08'\nGROUP BY \n    DATE_FORMAT(`dteventtime`, '%Y%m%d'),\n    `shopid`\nORDER BY \n    stat_date, shopid;",
    "is_valid": true
  },
  {
    "sql_id": "sql_115",
    "sql": "SELECT \n    vplayerid,\n    COUNT(DISTINCT period_id) AS distinct_period_count\nFROM (\n    SELECT \n        vplayerid,\n        CASE\n            -- 新年竞赛杯\n            WHEN tdbank_imp_date >= '2024020200' AND tdbank_imp_date <= '2024020423' THEN '新年竞赛杯_1'\n            WHEN tdbank_imp_date >= '2024020900' AND tdbank_imp_date <= '2024021123' THEN '新年竞赛杯_2'\n            -- 明星竞赛杯\n            WHEN tdbank_imp_date >= '2023120800' AND tdbank_imp_date <= '2023121023' THEN '明星竞赛杯_1'\n            WHEN tdbank_imp_date >= '2023121500' AND tdbank_imp_date <= '2023121723' THEN '明星竞赛杯_2'\n            -- 众竞赛道\n            WHEN tdbank_imp_date >= '2023100600' AND tdbank_imp_date <= '2023100823' THEN '众竞赛道_1'\n            WHEN tdbank_imp_date >= '2023092900' AND tdbank_imp_date <= '2023100123' THEN '众竞赛道_2'\n            WHEN tdbank_imp_date >= '2023092200' AND tdbank_imp_date <= '2023092423' THEN '众竞赛道_3'\n            -- 珍禽竞赛杯\n            WHEN tdbank_imp_date >= '2023072100' AND tdbank_imp_date <= '2023072323' THEN '珍禽竞赛杯_1'\n            WHEN tdbank_imp_date >= '2023072800' AND tdbank_imp_date <= '2023073023' THEN '珍禽竞赛杯_2'\n            -- 都会竞速\n            WHEN tdbank_imp_date >= '2023051900' AND tdbank_imp_date <= '2023061123' THEN '都会竞速_1'\n            WHEN tdbank_imp_date >= '2023061600' AND tdbank_imp_date <= '2023062523' THEN '都会竞速_2'\n            -- 寒域竞赛杯\n            WHEN tdbank_imp_date >= '2023050500' AND tdbank_imp_date <= '2023050723' THEN '寒域竞赛杯_1'\n            WHEN tdbank_imp_date >= '2023051200' AND tdbank_imp_date <= '2023051423' THEN '寒域竞赛杯_2'\n            -- 飞跃竞赛杯\n            WHEN tdbank_imp_date >= '2023012100' AND tdbank_imp_date <= '2023012723' THEN '飞跃竞赛杯_1'\n            -- 联队竞赛杯\n            WHEN tdbank_imp_date >= '2022112500' AND tdbank_imp_date <= '2022112723' THEN '联队竞赛杯_1'\n            WHEN tdbank_imp_date >= '2022120200' AND tdbank_imp_date <= '2022120423' THEN '联队竞赛杯_2'\n            -- 职赛杯\n            WHEN tdbank_imp_date >= '2022081900' AND tdbank_imp_date <= '2022082123' THEN '职赛杯_1'\n            WHEN tdbank_imp_date >= '2022082600' AND tdbank_imp_date <= '2022082823' THEN '职赛杯_2'\n            -- 夏日假期竞赛杯\n            WHEN tdbank_imp_date >= '2022072200' AND tdbank_imp_date <= '2022072423' THEN '夏日假期竞赛杯_1'\n            WHEN tdbank_imp_date >= '2022072900' AND tdbank_imp_date <= '2022073123' THEN '夏日假期竞赛杯_2'\n            -- 众投竞赛（需要matchmode为1503或1603）\n            WHEN tdbank_imp_date >= '2022050600' AND tdbank_imp_date <= '2022050823' AND matchmode IN (1503, 1603) THEN '众投竞赛_1'\n            WHEN tdbank_imp_date >= '2022051300' AND tdbank_imp_date <= '2022051523' AND matchmode IN (1503, 1603) THEN '众投竞赛_2'\n            WHEN tdbank_imp_date >= '2022052000' AND tdbank_imp_date <= '2022052223' AND matchmode IN (1503, 1603) THEN '众投竞赛_3'\n        END AS period_id\n    FROM dwd_jordass_player_matchrecord_hi\n    WHERE tdbank_imp_date >= '2022050600' \n        AND tdbank_imp_date <= '2024021423'\n) t\nWHERE period_id IS NOT NULL\nGROUP BY vplayerid\nORDER BY distinct_period_count DESC;",
    "is_valid": true
  },
  {
    "sql_id": "sql_116",
    "sql": "SELECT \n    CASE \n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 90), '1') = 0 \n             AND INSTR(SUBSTR(a.cbitmap, 91, 90), '1') > 0 \n        THEN '近三个月流失'\n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 90), '1') > 0 \n             AND (b.vplayerid IS NULL OR INSTR(SUBSTR(b.cbitmap, 1, 90), '1') = 0) \n        THEN '近三个月活跃但近三个月无付费'\n        WHEN INSTR(SUBSTR(a.cbitmap, 1, 90), '1') > 0 \n             AND INSTR(SUBSTR(b.cbitmap, 1, 90), '1') > 0 \n        THEN '近三个月活跃且有付费'\n        ELSE '其他'\n    END AS user_type,\n    a.historymaxsegment,\n    CASE \n        WHEN b.imoney IS NULL OR b.imoney = 0 THEN '0'\n        WHEN b.imoney > 0 AND b.imoney <= 1200 THEN '(0-1200]'\n        WHEN b.imoney > 1200 AND b.imoney <= 6000 THEN '(1200-6000]'\n        WHEN b.imoney > 6000 AND b.imoney <= 18000 THEN '(6000-18000]'\n        WHEN b.imoney > 18000 THEN '(18000+]'\n    END AS pay_tier,\n    COUNT(DISTINCT a.vplayerid) AS user_count\nFROM dws_jordass_uid_login_df a\nLEFT JOIN dws_jordass_water_df b\n    ON a.vplayerid = b.vplayerid\n    AND a.vgameappid = b.vgameappid\n    AND b.dtstatdate = '20250225'\n    AND b.platid = 255\nWHERE a.dtstatdate = '20250225'\n    AND a.platid = 255\nGROUP BY \n    user_type,\n    a.historymaxsegment,\n    pay_tier\nORDER BY \n    user_type,\n    a.historymaxsegment,\n    pay_tier;",
    "is_valid": true
  },
  {
    "sql_id": "sql_117",
    "sql": "WITH top30_users AS (\n    SELECT \n        `vplayerid`,\n        COUNT(DISTINCT `dtstatdate`) AS active_days\n    FROM `dws_jordass_login_df`\n    WHERE `dtstatdate` BETWEEN '20250331' AND '20250510'\n        AND `platid` = 255\n        AND SUBSTR(`cbitmap`, 1, 1) = '1'\n    GROUP BY `vplayerid`\n    ORDER BY active_days DESC\n    LIMIT 30\n),\nuser_return_detail AS (\n    SELECT \n        a.`vplayerid`,\n        a.`dtstatdate`,\n        CASE \n            WHEN INSTR(SUBSTR(a.`cbitmap`, 2, 7), '1') = 0 \n                AND INSTR(SUBSTR(a.`cbitmap`, 9, 7), '1') = 0 \n                AND INSTR(SUBSTR(a.`cbitmap`, 16, 16), '1') = 0 \n            THEN '活跃'\n            WHEN INSTR(SUBSTR(a.`cbitmap`, 2, 7), '1') = 0 \n                AND INSTR(SUBSTR(a.`cbitmap`, 9, 7), '1') > 0 \n            THEN '7日回流'\n            WHEN INSTR(SUBSTR(a.`cbitmap`, 2, 14), '1') = 0 \n                AND INSTR(SUBSTR(a.`cbitmap`, 16, 16), '1') > 0 \n            THEN '14日回流'\n            WHEN INSTR(SUBSTR(a.`cbitmap`, 2, 30), '1') = 0 \n            THEN '30日回流'\n            ELSE '其他'\n        END AS return_type\n    FROM `dws_jordass_login_df` a\n    INNER JOIN top30_users b ON a.`vplayerid` = b.`vplayerid`\n    WHERE a.`dtstatdate` BETWEEN '20250331' AND '20250510'\n        AND a.`platid` = 255\n        AND SUBSTR(a.`cbitmap`, 1, 1) = '1'\n)\nSELECT \n    `return_type` AS 用户回流类型,\n    COUNT(DISTINCT `vplayerid`) AS 人数\nFROM user_return_detail\nGROUP BY `return_type`\nORDER BY \n    CASE `return_type`\n        WHEN '活跃' THEN 1\n        WHEN '7日回流' THEN 2\n        WHEN '14日回流' THEN 3\n        WHEN '30日回流' THEN 4\n        ELSE 5\n    END;",
    "is_valid": true
  },
  {
    "sql_id": "sql_118",
    "sql": "WITH \n-- 曝光用户\nexposure AS (\n    SELECT DISTINCT suser\n    FROM dwd_jordass_mysteryplaylog_hi\n    WHERE tdbank_imp_date BETWEEN '2024042600' AND '2024050523'\n      AND iactid = '1193536'\n      AND itype = '1'\n),\n-- 参与用户\nparticipate AS (\n    SELECT DISTINCT suser\n    FROM dwd_jordass_mysteryplaylog_hi\n    WHERE tdbank_imp_date BETWEEN '2024042600' AND '2024050523'\n      AND iactid = '1193536'\n      AND itype IN ('10','200','201','202','203','204','31','32','33','34','35','702','703')\n),\n-- 合并曝光和参与用户，计算状态\nuser_base AS (\n    SELECT \n        COALESCE(e.suser, p.suser) AS vplayerid,\n        CASE \n            WHEN e.suser IS NOT NULL AND p.suser IS NULL THEN '曝光未参与'\n            WHEN e.suser IS NOT NULL AND p.suser IS NOT NULL THEN '曝光且参与'\n        END AS exposure_participate_status\n    FROM exposure e\n    FULL OUTER JOIN participate p ON e.suser = p.suser\n)\nSELECT \n    ub.exposure_participate_status AS 曝光参与情况,\n    COUNT(DISTINCT ub.vplayerid) AS 人数,\n    COUNT(DISTINCT mr.vplayerid) AS 传统模式人数,\n    COALESCE(SUM(mr.roundcnt), 0) AS 传统模式对局数,\n    COALESCE(SUM(mr.roundtime), 0) AS 传统模式对局时长,\n    COUNT(DISTINCT login.vplayerid) AS 活跃人数,\n    COALESCE(SUM(login.ionlinetime), 0) AS 活跃时长,\n    COUNT(DISTINCT prof.vplayerid) AS 专业赛人数,\n    COUNT(CASE WHEN prof.vplayerid IS NOT NULL THEN 1 END) AS 专业赛局数\nFROM user_base ub\nLEFT JOIN dws_jordass_mode_roundrecord_di mr \n    ON ub.vplayerid = mr.vplayerid \n    AND mr.dtstatdate BETWEEN '20240426' AND '20240505'\nLEFT JOIN dws_jordass_login_di login \n    ON ub.vplayerid = login.vplayerid \n    AND login.dtstatdate BETWEEN '20240426' AND '20240505'\n    AND login.platid = 255\nLEFT JOIN dwd_jordass_playerprofstagechange_hi prof \n    ON ub.vplayerid = prof.vplayerid \n    AND prof.tdbank_imp_date BETWEEN '2024042600' AND '2024050523'\n    AND prof.tournamentid = 30002\nWHERE ub.exposure_participate_status IS NOT NULL\nGROUP BY ub.exposure_participate_status\nORDER BY ub.exposure_participate_status;",
    "is_valid": true
  },
  {
    "sql_id": "sql_119",
    "sql": "SELECT \n    dtstatdate AS 统计日期,\n    CASE \n        WHEN INSTR(SUBSTR(cbitmap, 2, 15), '1') = 0 THEN '后续半个月未登录' \n        ELSE '后续半个月有登录' \n    END AS 后续半个月活跃类型,\n    CASE \n        WHEN dregdate = dtstatdate THEN '新增'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 7), '1') > 0 THEN '7日以内留存'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 7), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 8, 7), '1') > 0 THEN '7~14日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 14), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 15, 16), '1') > 0 THEN '14~30日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 30), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 31, 60), '1') > 0 THEN '30~90日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 90), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 91, 10), '1') > 0 THEN '90日以上回流'\n        ELSE NULL\n    END AS 用户类型,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM \n    dws_jordass_login_df\nWHERE \n    dtstatdate IN ('20250429', '20250601')\n    AND platid = 255\n    AND SUBSTR(cbitmap, 1, 1) = '1'\nGROUP BY \n    dtstatdate,\n    CASE \n        WHEN INSTR(SUBSTR(cbitmap, 2, 15), '1') = 0 THEN '后续半个月未登录' \n        ELSE '后续半个月有登录' \n    END,\n    CASE \n        WHEN dregdate = dtstatdate THEN '新增'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 7), '1') > 0 THEN '7日以内留存'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 7), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 8, 7), '1') > 0 THEN '7~14日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 14), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 15, 16), '1') > 0 THEN '14~30日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 30), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 31, 60), '1') > 0 THEN '30~90日回流'\n        WHEN INSTR(SUBSTR(cbitmap, 2, 90), '1') = 0 \n             AND INSTR(SUBSTR(cbitmap, 91, 10), '1') > 0 THEN '90日以上回流'\n        ELSE NULL\n    END\nORDER BY \n    dtstatdate,\n    后续半个月活跃类型,\n    用户类型;",
    "is_valid": true
  },
  {
    "sql_id": "sql_120",
    "sql": "SELECT \n    CASE \n        WHEN substr(a.cbitmap, 1, 2) = '11' THEN '7月24~7月25日持续活跃'\n        WHEN substr(a.cbitmap, 1, 2) = '01' THEN '7.24活跃7.25流失到盘外'\n    END AS user_type,\n    b.gender AS gender,\n    COUNT(DISTINCT a.vplayerid) AS user_count\nFROM \n    dws_jordass_login_df a\nINNER JOIN \n    dws_jordass_uid_login_df b\n    ON a.vplayerid = b.vplayerid\n    AND a.dtstatdate = b.dtstatdate\n    AND a.vgameappid = b.vgameappid\n    AND a.platid = b.platid\nWHERE \n    a.dtstatdate = '20250725'\n    AND a.platid = 255\n    AND a.vgameappid = 'qq'\n    AND b.dtstatdate = '20250725'\n    AND (substr(a.cbitmap, 1, 2) = '11' OR substr(a.cbitmap, 1, 2) = '01')\nGROUP BY \n    CASE \n        WHEN substr(a.cbitmap, 1, 2) = '11' THEN '7月24~7月25日持续活跃'\n        WHEN substr(a.cbitmap, 1, 2) = '01' THEN '7.24活跃7.25流失到盘外'\n    END,\n    b.gender\nORDER BY \n    user_type, gender;",
    "is_valid": true
  }
]